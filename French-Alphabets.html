<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Alphabets Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #faf8f1 0%, #f5f1e8 100%);
            padding: 0;
            margin: 0;
            display: flex;
            padding-top: 8rem;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1001;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            min-height: 120px;
        }
        
        .auth-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .nav-top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .nav-menu-row {
            display: flex;
            justify-content: flex-start;
            width: 100%;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #8b4513;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .gk-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b4513, #d4af37);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
            transition: all 0.3s ease;
        }

        .gk-logo:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 20px rgba(139, 69, 19, 0.4);
        }

        .gk-letters {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transform: skew(-10deg) rotate(-5deg);
            letter-spacing: -2px;
            position: relative;
        }

        .gk-letters::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, white, transparent);
            animation: running-line 2s ease-in-out infinite;
        }

        @keyframes running-line {
            0%, 100% { transform: translateX(-100%); opacity: 0; }
            50% { transform: translateX(0); opacity: 1; }
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .logo-image {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #8b4513;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #3c2d1f;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
        }

        .nav-links a:hover {
            color: #8b4513;
            text-decoration: none;
        }

        .nav-links > li > a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: #8b4513;
            transition: width 0.3s ease;
        }

        .nav-links > li > a:hover::after {
            width: 100%;
        }

        /* Navigation Donate Button Styles - Aligned parallel to menu items */
        .nav-donate {
            display: none; /* Hidden by default, shown only when user is signed in */
        }

        .nav-donate-btn {
            background: none;
            border: none;
            color: #3c2d1f; /* Match menu items color */
            font-weight: 500; /* Match menu items font-weight */
            font-size: 1rem; /* Match menu items font-size */
            cursor: pointer;
            transition: color 0.3s ease; /* Match menu items transition */
            position: relative; /* For underline effect */
            padding: 0; /* Remove padding to match menu links */
            text-decoration: none;
            display: inline-block; /* Match menu links display */
            line-height: normal;
        }

        .nav-donate-btn:hover {
            color: #8b4513; /* Match menu items hover color */
            background: none;
            text-decoration: none; /* Match menu items hover */
        }

        .nav-donate-btn::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px; /* Match menu items underline height */
            bottom: -5px; /* Match menu items underline position */
            left: 0; /* Match menu items underline alignment */
            background-color: #8b4513; /* Match menu items underline color */
            transition: width 0.3s ease; /* Match menu items transition */
        }

        .nav-donate-btn:hover::after {
            width: 100%;
        }

        /* Donation Modal Styles */
        .donation-amounts {
            margin: 2rem 0;
        }

        .amount-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .amount-btn {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #495057;
            border: 2px solid #dee2e6;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .amount-btn:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .amount-btn.selected {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border-color: #c0392b;
        }

        .custom-amount {
            text-align: center;
            margin-top: 1.5rem;
        }

        .custom-amount label {
            display: block;
            margin-bottom: 0.5rem;
            color: #666;
            font-weight: 500;
        }

        .amount-input-container {
            display: inline-flex;
            align-items: center;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            max-width: 200px;
            margin: 0 auto;
        }

        .currency-symbol {
            padding: 0.75rem 0.5rem 0.75rem 1rem;
            background: #f8f9fa;
            color: #666;
            font-weight: 600;
            font-size: 1.1rem;
        }

        #customAmount {
            border: none;
            outline: none;
            padding: 0.75rem 1rem 0.75rem 0.5rem;
            font-size: 1.1rem;
            width: 120px;
            background: transparent;
        }

        .selected-amount-display {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .selected-amount-display p {
            margin: 0;
            font-size: 1.1rem;
            color: #495057;
        }

        @media (max-width: 768px) {
            .amount-buttons {
                gap: 0.5rem;
            }
            
            .amount-btn {
                padding: 0.8rem 1rem;
                font-size: 1rem;
                min-width: 60px;
            }
        }

        /* Dropdown Menu Styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-radius: 8px;
            z-index: 1002;
            top: 100%;
            left: 0;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .dropdown-content.show {
            display: block;
            animation: dropdownFadeIn 0.3s ease;
        }

        @keyframes dropdownFadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s ease;
            position: relative;
            white-space: nowrap;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .dropdown-item:hover {
            background-color: #f5f1e8;
            color: #8b4513;
            text-decoration: none;
        }

        .dropdown-item::after {
            display: none;
        }

        /* Premium feature styling */
        .dropdown-item.premium-feature {
            position: relative;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(255, 237, 74, 0.1));
            border-left: 3px solid #ffd700;
        }

        .dropdown-item.premium-locked {
            opacity: 0.8;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.05), rgba(255, 237, 74, 0.05));
            cursor: pointer;
        }

        .dropdown-item.premium-locked:hover {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(255, 237, 74, 0.15));
            transform: none;
        }

        .dropdown-toggle {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dropdown-arrow {
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }

        .dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        /* Nested Dropdown */
        .nested-dropdown {
            position: relative;
        }

        .nested-dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-radius: 8px;
            z-index: 1003;
            top: 0;
            left: 100%;
            margin-left: 5px;
            border: 1px solid #e2e8f0;
        }

        .nested-dropdown-content.show {
            display: block;
            animation: dropdownFadeIn 0.3s ease;
        }

        .nested-dropdown:hover .nested-dropdown-content {
            display: block;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            border: 1px solid rgba(255,255,255,0.2);
            position: fixed;
            top: 160px;
            height: calc(100vh - 180px);
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .sidebar-header h3 {
            color: #374151;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin: 0;
        }

        /* Module Slider */
        .module-slider {
            position: relative;
            padding: 0.5rem 0;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            scrollbar-width: thin;
            scrollbar-color: #d1d5db #f8fafc;
            -webkit-overflow-scrolling: touch;
        }

        .slider-container::-webkit-scrollbar {
            width: 6px;
        }

        .slider-container::-webkit-scrollbar-track {
            background: #f8fafc;
            border-radius: 3px;
        }

        .slider-container::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
            transition: background 0.2s ease;
        }

        .slider-container::-webkit-scrollbar-thumb:hover {
            background: #8b4513;
        }

        .slider-item {
            width: 100%;
            flex-shrink: 0;
            padding: 0.875rem;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .slider-item:hover {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.25);
        }

        .slider-item.available {
            cursor: pointer;
        }

        .slider-item.coming-soon {
            color: #9ca3af;
            cursor: default;
            opacity: 0.8;
        }

        .slider-item.coming-soon:hover {
            background: #f1f5f9;
            color: #6b7280;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .slider-item .icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .slider-item .module-info {
            flex: 1;
            min-width: 0;
        }

        .slider-item .module-name {
            font-weight: 600;
            margin: 0 0 0.25rem 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .slider-item .module-status {
            font-size: 0.625rem;
            margin: 0;
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .slider-badge {
            padding: 0.2rem 0.4rem;
            border-radius: 6px;
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            flex-shrink: 0;
        }

        .slider-badge.premium {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: #92400e;
        }

        .slider-badge.coming-soon {
            background: #e5e7eb;
            color: #6b7280;
        }

        /* Scroll hint indicator */
        .scroll-hint {
            text-align: center;
            padding: 0.5rem 1.25rem;
            font-size: 0.75rem;
            color: #9ca3af;
            font-style: italic;
        }

        /* Page Navigation */
        .page-navigation {
            border-top: 1px solid #f1f5f9;
            margin-top: 1rem;
        }

        .nav-section {
            padding: 0.5rem 0;
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-list li {
            margin: 0;
            border-bottom: 1px solid #f8fafc;
        }

        .nav-list li:last-child {
            border-bottom: none;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            text-decoration: none;
            color: #374151;
            background: transparent;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.875rem;
            position: relative;
        }

        .nav-link:hover {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: white;
            padding-left: 1.5rem;
        }

        /* Expandable sections */
        .expandable-section {
            margin-bottom: 1rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            color: #374151;
            font-size: 0.875rem;
            font-weight: 600;
            background: #f8fafc;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }

        .section-header:hover {
            background: #f1f5f9;
            color: #8b4513;
        }

        .expand-icon {
            transition: transform 0.3s ease;
            font-size: 0.75rem;
        }

        .expand-icon.expanded {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 1000px;
        }

        /* Back Button */
        .back-button-section {
            padding: 1rem 1rem 0.5rem 1rem;
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            text-decoration: none !important;
            color: #374151;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 10px;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.875rem;
            border: 1px solid #e5e7eb;
        }

        .back-button:hover {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: white;
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.25);
            text-decoration: none;
        }

        .back-icon {
            font-size: 1.25rem;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .back-button:hover .back-icon {
            transform: translateX(-3px);
        }

        .back-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Main Content Styles */
        .main-content {
            margin-left: 260px;
            padding: 2rem;
            flex: 1;
            min-height: 100vh;
        }
        
        /* Professional Content Spacing */
        .main-content > div {
            margin-bottom: 3rem;
        }
        
        .main-content h1 {
            margin-bottom: 1rem;
            margin-top: 0;
        }
        
        .main-content h2 {
            margin-top: 3rem;
            margin-bottom: 1.5rem;
        }
        
        .search-container {
            margin: 2rem 0;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .dropdown-content {
                position: fixed;
                top: 70px;
                left: 10px;
                right: 10px;
                min-width: auto;
                max-width: none;
            }

            .nested-dropdown-content {
                position: static;
                box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
                margin: 5px 0;
                border-radius: 4px;
            }

            .sidebar {
                width: 250px;
                transform: translateX(-100%);
                top: 80px;
                height: calc(100vh - 80px);
                border-radius: 0;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }

            .slider-container {
                max-height: 200px;
            }
            
            .menu-toggle {
                display: block;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 1001;
                background: #b8860b;
                color: #fff;
                border: none;
                padding: 0.5rem;
                border-radius: 4px;
                cursor: pointer;
            }
        }
        
        .menu-toggle {
            display: none;
        }
        
        h1, h2 {
            color: #3c2d1f;
            text-align: center;
        }
        
        table {
            margin: 2rem auto;
            border-collapse: collapse;
            width: 80%;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        th, td {
            border: 1px solid #d4af37;
            padding: 0.75rem 1rem;
            text-align: center;
        }
        
        th {
            background: #f5f1e8;
        }
        
        a {
            color: #8b4513;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        button {
            background: #b8860b;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 0.4rem 1rem;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button:hover {
            background: #d4af37;
        }
        
        .master-play {
            display: block;
            margin: 0 auto 1.5rem auto;
            font-size: 1.1rem;
            padding: 0.5rem 1.5rem;
        }
        
        .drill-up {
            display: block;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }
        
        .letter-section {
            margin-bottom: 3rem;
            background: #fff;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .letter-pronunciation {
            font-size: 3rem;
            color: #b8860b;
            text-align: center;
            margin: 1rem 0;
            font-weight: bold;
        }
        
        .pronunciation-guide {
            background: #faf8f1;
            border-left: 4px solid #b8860b;
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        /* Search Bar Styles */
        .search-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-box {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        #searchInput {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        #searchInput:focus {
            outline: none;
            border-color: #b8860b;
            box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
        }

        #searchButton {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #b8860b, #d4af37);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        #searchButton:hover {
            background: linear-gradient(135deg, #d4af37, #cd853f);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(184, 134, 11, 0.3);
        }

        .search-results {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            display: none;
            font-size: 0.9rem;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: white;
            border-left: 3px solid #b8860b;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: #f1f5f9;
            transform: translateX(2px);
        }

        .search-no-results {
            color: #6b7280;
            text-align: center;
            padding: 1rem;
            font-style: italic;
        }

        /* Word highlighting when audio is playing */
        .word-highlight {
            background: linear-gradient(135deg, #ffd700, #ffed4e) !important;
            color: #8b4513 !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-weight: bold !important;
            animation: pulse 1.5s ease-in-out infinite !important;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4) !important;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Authentication Styles */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sign-in-btn, .sign-up-btn, .sign-out-btn {
            padding: 0.25rem 0.6rem;
            border: none;
            border-radius: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.7rem;
        }
        
        .subscription-status {
            font-size: 0.625rem;
            padding: 0.15rem 0.4rem;
            border-radius: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .subscription-status.premium {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #8b4513;
            border: 1px solid #d4af37;
        }
        
        .subscription-status.free {
            background: rgba(156, 163, 175, 0.2);
            color: #6b7280;
            border: 1px solid #d1d5db;
        }

        .sign-in-btn {
            background: transparent;
            color: #8b4513;
            border: 2px solid #8b4513;
        }

        .sign-in-btn:hover {
            background: #8b4513;
            color: white;
        }

        .sign-up-btn {
            background: linear-gradient(135deg, #8b4513, #d4af37);
            color: white;
            border: 2px solid transparent;
        }

        .sign-up-btn:hover {
            background: linear-gradient(135deg, #654321, #b8860b);
            transform: translateY(-2px);
        }

        .sign-out-btn {
            background: #dc3545;
            color: white;
            border: 2px solid #dc3545;
        }

        .sign-out-btn:hover {
            background: #c82333;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #8b4513;
            font-weight: 500;
            font-size: 0.75rem;
        }
        
        .user-profile span#userName {
            font-size: 0.75rem;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            .auth-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }

        .close:hover {
            color: #8b4513;
        }

        .modal h2 {
            color: #8b4513;
            margin-bottom: 0.8rem;
            text-align: center;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #3c2d1f;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #8b4513;
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }

        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus {
            outline: none;
            border-color: #8b4513;
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, #8b4513, #d4af37);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1rem 0;
        }

        .auth-btn:hover {
            background: linear-gradient(135deg, #654321, #b8860b);
            transform: translateY(-2px);
        }

        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .switch-auth {
            text-align: center;
            margin-top: 1rem;
            color: #666;
        }

        .switch-auth a {
            color: #8b4513;
            text-decoration: none;
            font-weight: 500;
        }

        .switch-auth a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #f5c6cb;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #8b4513;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .user-greeting {
            color: #2d3748;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .subscription-status.premium {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #8b4513;
            border: 1px solid #d4af37;
        }

        .subscription-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            padding: 0.25rem 0.6rem;
            border-radius: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.7rem;
            text-decoration: none;
            display: none; /* Hide by default to prevent flash for premium users */
            align-items: center;
            gap: 0.4rem;
        }

        .subscription-btn:hover {
            background: linear-gradient(135deg, #218838, #1fa186);
            transform: translateY(-2px);
        }

        .subscription-btn.premium {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #8b4513;
            font-weight: 600;
        }

        .subscription-btn.premium:hover {
            background: linear-gradient(135deg, #ffed4e, #ff7f00);
        }

        /* Subscription Modal Styles */
        .subscription-modal-content {
            max-width: 950px;
            padding: 1.2rem;
            max-height: 90vh;
            overflow-y: auto;
        }

        .subscription-plans {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.2rem 0;
        }

        .plan-card {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 320px;
        }

        .plan-card:hover {
            border-color: #28a745;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
            transform: translateY(-3px);
        }

        .plan-card.selected {
            border: 3px solid #28a745;
            box-shadow: 0 8px 30px rgba(40, 167, 69, 0.3);
            transform: translateY(-5px);
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(32, 201, 151, 0.1));
        }

        .plan-card.selected::before {
            content: '‚úÖ SELECTED';
            position: absolute;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .plan-card.popular {
            border-color: #3498db;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .plan-card.popular:hover, .plan-card.popular.selected {
            border-color: #2980b9;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .plan-card.premium {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fff9c4, #ffeaa7);
        }

        .plan-card.premium:hover, .plan-card.premium.selected {
            border-color: #ff8c00;
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.3);
        }

        .plan-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.4rem;
        }

        .plan-price {
            font-size: 1.4rem;
            font-weight: 800;
            color: #27ae60;
            margin-bottom: 0.8rem;
        }

        .plan-price .currency {
            font-size: 0.9rem;
            vertical-align: top;
        }

        .plan-price .period {
            font-size: 0.8rem;
            color: #7f8c8d;
            font-weight: 400;
        }

        .plan-features {
            list-style: none;
            padding: 0;
            margin: 0.5rem 0;
            font-size: 0.75rem;
        }

        .plan-features li {
            padding: 0.15rem 0;
            color: #2c3e50;
            position: relative;
        }

        .plan-features li::before {
            content: '‚úì';
            color: #28a745;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        /* Enhanced mobile responsiveness for subscription plans */
        @media (max-width: 768px) {
            .subscription-modal-content {
                width: 98% !important;
                max-width: 98% !important;
                margin: 1% auto !important;
                padding: 1rem !important;
                max-height: 95vh !important;
                overflow-y: auto !important;
            }
            
            .subscription-plans {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            .plan-card {
                padding: 1rem !important;
                min-height: auto !important;
                margin-bottom: 1rem;
            }
            
            .plan-price {
                font-size: 1.8rem !important;
            }
            
            .payment-section {
                padding: 1rem !important;
                margin-top: 1rem !important;
            }
            
            .subscription-btn-modal {
                width: 100% !important;
                padding: 1rem !important;
                font-size: 1.1rem !important;
                margin-top: 1rem !important;
                min-height: 50px;
                touch-action: manipulation;
            }
            
            /* Touch-friendly form inputs */
            #cardholderName, #card-element {
                padding: 1rem !important;
                font-size: 16px !important; /* Prevents zoom on iOS */
                min-height: 44px !important;
                touch-action: manipulation;
            }
            
            /* Mobile-friendly navigation and buttons */
            .alphabet-section, .module-card {
                margin-bottom: 1rem;
                padding: 1rem !important;
            }
            
            .premium-badge {
                font-size: 0.8rem !important;
                padding: 0.5rem 1rem !important;
                min-height: 40px;
            }
            
            .nav-menu-row {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }

        @media (max-width: 1024px) and (min-width: 769px) {
            .subscription-plans {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .subscription-modal-content {
                width: 100% !important;
                height: 100vh !important;
                max-height: 100vh !important;
                margin: 0 !important;
                border-radius: 0 !important;
                padding: 1rem 0.5rem !important;
            }
            
            .plan-price {
                font-size: 1.5rem !important;
            }
        }

        .payment-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e2e8f0;
        }

        .payment-form {
            margin-top: 1rem;
        }

        #card-element {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin: 1rem 0;
            transition: border-color 0.3s ease;
        }

        #card-element:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .subscription-btn-modal {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .subscription-btn-modal:hover {
            background: linear-gradient(135deg, #218838, #1e7e34);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .subscription-btn-modal:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <!-- Main Navigation -->
        <nav class="nav-container">
            <!-- Top Row: Logo + Auth -->
            <div class="nav-top-row">
                <a href="index.html" class="logo-container">
                    <div class="gk-logo">
                        <span class="gk-letters">GK</span>
                    </div>
                    <span class="logo">Foundation</span>
                </a>
                <div class="auth-status">
                    <div id="userStatus" class="user-status" style="display: none;">
                        <span id="userGreeting" class="user-greeting"></span>
                        <button id="subscriptionBtn" class="subscription-btn" onclick="openSubscriptionModal()">üíé Go Premium</button>
                    </div>
                    <div class="auth-buttons">
                        <button id="signInBtn" class="sign-in-btn" onclick="openSignInModal()">Sign In</button>
                        <button id="signUpBtn" class="sign-up-btn" onclick="openSignUpModal()">Sign Up</button>
                        <button id="signOutBtn" class="sign-out-btn" style="display: none;" onclick="signOut()">Sign Out</button>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Row: Menu Items -->
            <div class="nav-menu-row">
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" onclick="toggleDropdown(event, 'frenchLearningDropdown')">
                            Our Offerings
                            <span class="dropdown-arrow">‚ñº</span>
                        </a>
                        <div class="dropdown-content" id="frenchLearningDropdown">
                                                            <a href="French-for-Beginners.html" class="dropdown-item">üéì French for Beginners</a>
                        </div>
                    </li>
                    <li><a href="index.html#modules">Learning Modules</a></li>
                    <li><a href="index.html#features">Features</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li class="nav-donate">
                        <button class="nav-donate-btn" onclick="openDonationModal()">‚ù§Ô∏è Support Us</button>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞ Menu</button>
    
    <div class="sidebar" id="sidebar">
        <!-- Back Button -->
        <div class="back-button-section">
            <a href="French-for-Beginners.html" class="back-button">
                <span class="back-icon">‚Üê</span>
                <span class="back-text">Back</span>
            </a>
        </div>
        
        <!-- Page-Specific Navigation -->
        <div class="nav-section">
            <ul class="nav-list">
                <li><a href="#top" class="nav-link">‚Üë Back to Top</a></li>
                <li><a href="#alphabet-overview" class="nav-link">Alphabet Overview</a></li>
                <li><a href="#french-accents-overview" class="nav-link">French Accents Overview</a></li>
            </ul>
        </div>
        
        <div class="expandable-section">
            <div class="section-header" onclick="toggleSection('all-letters')">
                <span>üî§ All Letters</span>
                <span class="expand-icon" id="all-letters-icon">‚ñ∂</span>
            </div>
            <div class="collapsible-content" id="all-letters-content">
                <ul class="nav-list">
                    <li><a href="#letter-a" class="nav-link">A (ah)</a></li>
                    <li><a href="#letter-b" class="nav-link">B (bay)</a></li>
                    <li><a href="#letter-c" class="nav-link">C (say)</a></li>
                    <li><a href="#letter-d" class="nav-link">D (day)</a></li>
                    <li><a href="#letter-e" class="nav-link">E (euh)</a></li>
                    <li><a href="#letter-f" class="nav-link">F (eff)</a></li>
                    <li><a href="#letter-g" class="nav-link">G (zhay)</a></li>
                    <li><a href="#letter-h" class="nav-link">H (ahsh)</a></li>
                    <li><a href="#letter-i" class="nav-link">I (ee)</a></li>
                    <li><a href="#letter-j" class="nav-link">J (zhee)</a></li>
                    <li><a href="#letter-k" class="nav-link">K (kah)</a></li>
                    <li><a href="#letter-l" class="nav-link">L (ell)</a></li>
                    <li><a href="#letter-m" class="nav-link">M (emm)</a></li>
                    <li><a href="#letter-n" class="nav-link">N (enn)</a></li>
                    <li><a href="#letter-o" class="nav-link">O (oh)</a></li>
                    <li><a href="#letter-p" class="nav-link">P (pay)</a></li>
                    <li><a href="#letter-q" class="nav-link">Q (koo)</a></li>
                    <li><a href="#letter-r" class="nav-link">R (err)</a></li>
                    <li><a href="#letter-s" class="nav-link">S (ess)</a></li>
                    <li><a href="#letter-t" class="nav-link">T (tay)</a></li>
                    <li><a href="#letter-u" class="nav-link">U (oo)</a></li>
                    <li><a href="#letter-v" class="nav-link">V (vay)</a></li>
                    <li><a href="#letter-w" class="nav-link">W (doo-bluh-vay)</a></li>
                    <li><a href="#letter-x" class="nav-link">X (eeks)</a></li>
                    <li><a href="#letter-y" class="nav-link">Y (ee-grek)</a></li>
                    <li><a href="#letter-z" class="nav-link">Z (zed)</a></li>
                </ul>
            </div>
        </div>

        <div class="expandable-section">
            <div class="section-header" onclick="toggleSection('french-accents')">
                <span>‚úèÔ∏è French Accents</span>
                <span class="expand-icon" id="french-accents-icon">‚ñ∂</span>
            </div>
            <div class="collapsible-content" id="french-accents-content">
                <ul class="nav-list">
                    <li><a href="#accent-aigu" class="nav-link">√© - Accent Aigu (acute)</a></li>
                    <li><a href="#accent-grave" class="nav-link">√®, √†, √π - Accent Grave</a></li>
                    <li><a href="#accent-circonflexe" class="nav-link">√™, √¢, √Æ, √¥, √ª - Circonflexe</a></li>
                    <li><a href="#accent-trema" class="nav-link">√´, √Ø, √º, √ø - Tr√©ma (diaeresis)</a></li>
                    <li><a href="#accent-cedille" class="nav-link">√ß - C√©dille (cedilla)</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div id="top">
            <h1>French Alphabet Learning</h1>
            <p>Master the French alphabet with detailed pronunciation guides, examples, and audio practice. Each letter is presented with its French pronunciation, English approximation, and practical usage examples.</p>
        </div>
        
        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search for any letter or word (e.g., A, letter-b, pronunciation)..." />
                <button id="searchButton" onclick="performSearch()">üîç Search</button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>
        
        <div id="alphabet-overview">
            <h2>The French Alphabet</h2>
            <div style="text-align: center; margin: 1rem 0;">
                <button class="master-play" onclick="playEntireAlphabet()">‚ñ∂Ô∏è Play Entire French Alphabet</button>
            </div>
            <div style="max-width: 800px; margin: 0 auto 1.5rem auto; background: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem 1.5rem; color: #8b4513; font-size: 1.08rem;">
                <strong>Learning the French Alphabet</strong><br>
                The French alphabet has the same 26 letters as English, but each letter has its own French pronunciation. Mastering the alphabet is essential for spelling, pronunciation, and understanding spoken French. Each letter can be pronounced individually or used in combination with others to form different sounds.<br><br>
                <strong>Pronunciation Tips</strong><br>
                French letter pronunciation is quite different from English. Listen carefully to each letter and practice saying them aloud. Pay special attention to letters like 'H' (silent), 'R' (rolled), and vowels which have distinct French sounds.
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Letter</th>
                        <th>French Pronunciation</th>
                        <th>English Approximation</th>
                        <th>Go to Details</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>A</td><td>a</td><td>ah</td><td><a href="#letter-a">Go</a></td></tr>
                    <tr><td>B</td><td>b√©</td><td>bay</td><td><a href="#letter-b">Go</a></td></tr>
                    <tr><td>C</td><td>c√©</td><td>say</td><td><a href="#letter-c">Go</a></td></tr>
                    <tr><td>D</td><td>d√©</td><td>day</td><td><a href="#letter-d">Go</a></td></tr>
                    <tr><td>E</td><td>e</td><td>euh</td><td><a href="#letter-e">Go</a></td></tr>
                    <tr><td>F</td><td>effe</td><td>eff</td><td><a href="#letter-f">Go</a></td></tr>
                    <tr><td>G</td><td>g√©</td><td>zhay</td><td><a href="#letter-g">Go</a></td></tr>
                    <tr><td>H</td><td>ache</td><td>ahsh</td><td><a href="#letter-h">Go</a></td></tr>
                    <tr><td>I</td><td>i</td><td>ee</td><td><a href="#letter-i">Go</a></td></tr>
                    <tr><td>J</td><td>ji</td><td>zhee</td><td><a href="#letter-j">Go</a></td></tr>
                    <tr><td>K</td><td>ka</td><td>kah</td><td><a href="#letter-k">Go</a></td></tr>
                    <tr><td>L</td><td>elle</td><td>ell</td><td><a href="#letter-l">Go</a></td></tr>
                    <tr><td>M</td><td>emme</td><td>emm</td><td><a href="#letter-m">Go</a></td></tr>
                    <tr><td>N</td><td>enne</td><td>enn</td><td><a href="#letter-n">Go</a></td></tr>
                    <tr><td>O</td><td>o</td><td>oh</td><td><a href="#letter-o">Go</a></td></tr>
                    <tr><td>P</td><td>p√©</td><td>pay</td><td><a href="#letter-p">Go</a></td></tr>
                    <tr><td>Q</td><td>cu</td><td>koo</td><td><a href="#letter-q">Go</a></td></tr>
                    <tr><td>R</td><td>erre</td><td>err</td><td><a href="#letter-r">Go</a></td></tr>
                    <tr><td>S</td><td>esse</td><td>ess</td><td><a href="#letter-s">Go</a></td></tr>
                    <tr><td>T</td><td>t√©</td><td>tay</td><td><a href="#letter-t">Go</a></td></tr>
                    <tr><td>U</td><td>u</td><td>oo</td><td><a href="#letter-u">Go</a></td></tr>
                    <tr><td>V</td><td>v√©</td><td>vay</td><td><a href="#letter-v">Go</a></td></tr>
                    <tr><td>W</td><td>double v√©</td><td>doo-bluh-vay</td><td><a href="#letter-w">Go</a></td></tr>
                    <tr><td>X</td><td>ixe</td><td>eeks</td><td><a href="#letter-x">Go</a></td></tr>
                    <tr><td>Y</td><td>i grec</td><td>ee-grek</td><td><a href="#letter-y">Go</a></td></tr>
                    <tr><td>Z</td><td>z√®de</td><td>zed</td><td><a href="#letter-z">Go</a></td></tr>
                </tbody>
            </table>
        </div>

        <!-- Individual Letter Sections -->
        <div class="letter-section" id="letter-a">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter A</h2>
            <div class="letter-pronunciation">A</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> a (similar to "ah" in English)<br>
                <strong>English Approximation:</strong> ah<br>
                <strong>IPA Symbol:</strong> /a/
            </div>
            <button class="master-play" onclick="playLetter('A')">‚ñ∂Ô∏è Play Letter A</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>arbre</td><td>tree</td><td><button onclick="playAudio('arbre')">üîä</button></td></tr>
                    <tr><td>ami</td><td>friend</td><td><button onclick="playAudio('ami')">üîä</button></td></tr>
                    <tr><td>auto</td><td>car</td><td><button onclick="playAudio('auto')">üîä</button></td></tr>
                    <tr><td>avion</td><td>airplane</td><td><button onclick="playAudio('avion')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-b">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter B</h2>
            <div class="letter-pronunciation">B</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> b√© (similar to "bay" in English)<br>
                <strong>English Approximation:</strong> bay<br>
                <strong>IPA Symbol:</strong> /be/
            </div>
            <button class="master-play" onclick="playLetter('B')">‚ñ∂Ô∏è Play Letter B</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>bonjour</td><td>hello</td><td><button onclick="playAudio('bonjour')">üîä</button></td></tr>
                    <tr><td>bleu</td><td>blue</td><td><button onclick="playAudio('bleu')">üîä</button></td></tr>
                    <tr><td>boire</td><td>to drink</td><td><button onclick="playAudio('boire')">üîä</button></td></tr>
                    <tr><td>beau</td><td>beautiful</td><td><button onclick="playAudio('beau')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-c">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter C</h2>
            <div class="letter-pronunciation">C</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> c√© (similar to "say" in English)<br>
                <strong>English Approximation:</strong> say<br>
                <strong>IPA Symbol:</strong> /se/<br>
                <strong>Note:</strong> C can be hard (like 'k') or soft (like 's') depending on the following letter
            </div>
            <button class="master-play" onclick="playLetter('C')">‚ñ∂Ô∏è Play Letter C</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>chat</td><td>cat</td><td><button onclick="playAudio('chat')">üîä</button></td></tr>
                    <tr><td>caf√©</td><td>coffee</td><td><button onclick="playAudio('caf√©')">üîä</button></td></tr>
                    <tr><td>cours</td><td>class</td><td><button onclick="playAudio('cours')">üîä</button></td></tr>
                    <tr><td>ciel</td><td>sky</td><td><button onclick="playAudio('ciel')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-d">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter D</h2>
            <div class="letter-pronunciation">D</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> d√© (similar to "day" in English)<br>
                <strong>English Approximation:</strong> day<br>
                <strong>IPA Symbol:</strong> /de/
            </div>
            <button class="master-play" onclick="playLetter('D')">‚ñ∂Ô∏è Play Letter D</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>deux</td><td>two</td><td><button onclick="playAudio('deux')">üîä</button></td></tr>
                    <tr><td>dire</td><td>to say</td><td><button onclick="playAudio('dire')">üîä</button></td></tr>
                    <tr><td>doux</td><td>soft</td><td><button onclick="playAudio('doux')">üîä</button></td></tr>
                    <tr><td>donner</td><td>to give</td><td><button onclick="playAudio('donner')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-e">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter E</h2>
            <div class="letter-pronunciation">E</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> e (similar to "euh" in English)<br>
                <strong>English Approximation:</strong> euh<br>
                <strong>IPA Symbol:</strong> /…ô/<br>
                <strong>Note:</strong> E can have different sounds: √© (ay), √® (eh), √™ (eh), e silent
            </div>
            <button class="master-play" onclick="playLetter('E')">‚ñ∂Ô∏è Play Letter E</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>√©cole</td><td>school</td><td><button onclick="playAudio('√©cole')">üîä</button></td></tr>
                    <tr><td>√™tre</td><td>to be</td><td><button onclick="playAudio('√™tre')">üîä</button></td></tr>
                    <tr><td>eau</td><td>water</td><td><button onclick="playAudio('eau')">üîä</button></td></tr>
                    <tr><td>elle</td><td>she</td><td><button onclick="playAudio('elle')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-f">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter F</h2>
            <div class="letter-pronunciation">F</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> effe (similar to "eff" in English)<br>
                <strong>English Approximation:</strong> eff<br>
                <strong>IPA Symbol:</strong> /…õf/
            </div>
            <button class="master-play" onclick="playLetter('F')">‚ñ∂Ô∏è Play Letter F</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>Fran√ßais</td><td>French</td><td><button onclick="playAudio('Fran√ßais')">üîä</button></td></tr>
                    <tr><td>faire</td><td>to do</td><td><button onclick="playAudio('faire')">üîä</button></td></tr>
                    <tr><td>fille</td><td>girl</td><td><button onclick="playAudio('fille')">üîä</button></td></tr>
                    <tr><td>froid</td><td>cold</td><td><button onclick="playAudio('froid')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-g">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter G</h2>
            <div class="letter-pronunciation">G</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> g√© (similar to "zhay" in English)<br>
                <strong>English Approximation:</strong> zhay<br>
                <strong>IPA Symbol:</strong> / íe/<br>
                <strong>Note:</strong> G can be hard (like 'g' in "go") or soft (like 'zh') depending on the following letter
            </div>
            <button class="master-play" onclick="playLetter('G')">‚ñ∂Ô∏è Play Letter G</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>grand</td><td>big</td><td><button onclick="playAudio('grand')">üîä</button></td></tr>
                    <tr><td>gare</td><td>station</td><td><button onclick="playAudio('gare')">üîä</button></td></tr>
                    <tr><td>gens</td><td>people</td><td><button onclick="playAudio('gens')">üîä</button></td></tr>
                    <tr><td>go√ªt</td><td>taste</td><td><button onclick="playAudio('go√ªt')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-h">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter H</h2>
            <div class="letter-pronunciation">H</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> ache (similar to "ahsh" in English)<br>
                <strong>English Approximation:</strong> ahsh<br>
                <strong>IPA Symbol:</strong> /a É/<br>
                <strong>Note:</strong> H is usually silent in French
            </div>
            <button class="master-play" onclick="playLetter('H')">‚ñ∂Ô∏è Play Letter H</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>heure</td><td>hour</td><td><button onclick="playAudio('heure')">üîä</button></td></tr>
                    <tr><td>homme</td><td>man</td><td><button onclick="playAudio('homme')">üîä</button></td></tr>
                    <tr><td>h√¥tel</td><td>hotel</td><td><button onclick="playAudio('h√¥tel')">üîä</button></td></tr>
                    <tr><td>hier</td><td>yesterday</td><td><button onclick="playAudio('hier')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-i">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter I</h2>
            <div class="letter-pronunciation">I</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> i (similar to "ee" in English)<br>
                <strong>English Approximation:</strong> ee<br>
                <strong>IPA Symbol:</strong> /i/
            </div>
            <button class="master-play" onclick="playLetter('I')">‚ñ∂Ô∏è Play Letter I</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>ici</td><td>here</td><td><button onclick="playAudio('ici')">üîä</button></td></tr>
                    <tr><td>il</td><td>he</td><td><button onclick="playAudio('il')">üîä</button></td></tr>
                    <tr><td>id√©e</td><td>idea</td><td><button onclick="playAudio('id√©e')">üîä</button></td></tr>
                    <tr><td>image</td><td>image</td><td><button onclick="playAudio('image')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-j">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter J</h2>
            <div class="letter-pronunciation">J</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> ji (similar to "zhee" in English)<br>
                <strong>English Approximation:</strong> zhee<br>
                <strong>IPA Symbol:</strong> / íi/
            </div>
            <button class="master-play" onclick="playLetter('J')">‚ñ∂Ô∏è Play Letter J</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>je</td><td>I</td><td><button onclick="playAudio('je')">üîä</button></td></tr>
                    <tr><td>jour</td><td>day</td><td><button onclick="playAudio('jour')">üîä</button></td></tr>
                    <tr><td>joli</td><td>pretty</td><td><button onclick="playAudio('joli')">üîä</button></td></tr>
                    <tr><td>jouer</td><td>to play</td><td><button onclick="playAudio('jouer')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-k">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter K</h2>
            <div class="letter-pronunciation">K</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> ka (similar to "kah" in English)<br>
                <strong>English Approximation:</strong> kah<br>
                <strong>IPA Symbol:</strong> /ka/
            </div>
            <button class="master-play" onclick="playLetter('K')">‚ñ∂Ô∏è Play Letter K</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>kilo</td><td>kilogram</td><td><button onclick="playAudio('kilo')">üîä</button></td></tr>
                    <tr><td>kayak</td><td>kayak</td><td><button onclick="playAudio('kayak')">üîä</button></td></tr>
                    <tr><td>kiwi</td><td>kiwi</td><td><button onclick="playAudio('kiwi')">üîä</button></td></tr>
                    <tr><td>karat√©</td><td>karate</td><td><button onclick="playAudio('karat√©')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-l">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter L</h2>
            <div class="letter-pronunciation">L</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> elle (similar to "ell" in English)<br>
                <strong>English Approximation:</strong> ell<br>
                <strong>IPA Symbol:</strong> /…õl/
            </div>
            <button class="master-play" onclick="playLetter('L')">‚ñ∂Ô∏è Play Letter L</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>lire</td><td>to read</td><td><button onclick="playAudio('lire')">üîä</button></td></tr>
                    <tr><td>livre</td><td>book</td><td><button onclick="playAudio('livre')">üîä</button></td></tr>
                    <tr><td>lieu</td><td>place</td><td><button onclick="playAudio('lieu')">üîä</button></td></tr>
                    <tr><td>lundi</td><td>Monday</td><td><button onclick="playAudio('lundi')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-m">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter M</h2>
            <div class="letter-pronunciation">M</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> emme (similar to "emm" in English)<br>
                <strong>English Approximation:</strong> emm<br>
                <strong>IPA Symbol:</strong> /…õm/
            </div>
            <button class="master-play" onclick="playLetter('M')">‚ñ∂Ô∏è Play Letter M</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>maman</td><td>mom</td><td><button onclick="playAudio('maman')">üîä</button></td></tr>
                    <tr><td>manger</td><td>to eat</td><td><button onclick="playAudio('manger')">üîä</button></td></tr>
                    <tr><td>maison</td><td>house</td><td><button onclick="playAudio('maison')">üîä</button></td></tr>
                    <tr><td>monde</td><td>world</td><td><button onclick="playAudio('monde')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-n">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter N</h2>
            <div class="letter-pronunciation">N</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> enne (similar to "enn" in English)<br>
                <strong>English Approximation:</strong> enn<br>
                <strong>IPA Symbol:</strong> /…õn/
            </div>
            <button class="master-play" onclick="playLetter('N')">‚ñ∂Ô∏è Play Letter N</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>non</td><td>no</td><td><button onclick="playAudio('non')">üîä</button></td></tr>
                    <tr><td>nom</td><td>name</td><td><button onclick="playAudio('nom')">üîä</button></td></tr>
                    <tr><td>nouveau</td><td>new</td><td><button onclick="playAudio('nouveau')">üîä</button></td></tr>
                    <tr><td>noir</td><td>black</td><td><button onclick="playAudio('noir')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-o">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter O</h2>
            <div class="letter-pronunciation">O</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> o (similar to "oh" in English)<br>
                <strong>English Approximation:</strong> oh<br>
                <strong>IPA Symbol:</strong> /o/
            </div>
            <button class="master-play" onclick="playLetter('O')">‚ñ∂Ô∏è Play Letter O</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>o√π</td><td>where</td><td><button onclick="playAudio('o√π')">üîä</button></td></tr>
                    <tr><td>oui</td><td>yes</td><td><button onclick="playAudio('oui')">üîä</button></td></tr>
                    <tr><td>ouvrir</td><td>to open</td><td><button onclick="playAudio('ouvrir')">üîä</button></td></tr>
                    <tr><td>orange</td><td>orange</td><td><button onclick="playAudio('orange')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-p">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter P</h2>
            <div class="letter-pronunciation">P</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> p√© (similar to "pay" in English)<br>
                <strong>English Approximation:</strong> pay<br>
                <strong>IPA Symbol:</strong> /pe/
            </div>
            <button class="master-play" onclick="playLetter('P')">‚ñ∂Ô∏è Play Letter P</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>papa</td><td>dad</td><td><button onclick="playAudio('papa')">üîä</button></td></tr>
                    <tr><td>parler</td><td>to speak</td><td><button onclick="playAudio('parler')">üîä</button></td></tr>
                    <tr><td>petit</td><td>small</td><td><button onclick="playAudio('petit')">üîä</button></td></tr>
                    <tr><td>pouvoir</td><td>can</td><td><button onclick="playAudio('pouvoir')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-q">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter Q</h2>
            <div class="letter-pronunciation">Q</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> cu (similar to "koo" in English)<br>
                <strong>English Approximation:</strong> koo<br>
                <strong>IPA Symbol:</strong> /ky/
            </div>
            <button class="master-play" onclick="playLetter('Q')">‚ñ∂Ô∏è Play Letter Q</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>que</td><td>what</td><td><button onclick="playAudio('que')">üîä</button></td></tr>
                    <tr><td>qui</td><td>who</td><td><button onclick="playAudio('qui')">üîä</button></td></tr>
                    <tr><td>quand</td><td>when</td><td><button onclick="playAudio('quand')">üîä</button></td></tr>
                    <tr><td>quatre</td><td>four</td><td><button onclick="playAudio('quatre')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-r">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter R</h2>
            <div class="letter-pronunciation">R</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> erre (similar to "err" in English)<br>
                <strong>English Approximation:</strong> err<br>
                <strong>IPA Symbol:</strong> /…õ Å/<br>
                <strong>Note:</strong> French R is rolled/guttural, very different from English R
            </div>
            <button class="master-play" onclick="playLetter('R')">‚ñ∂Ô∏è Play Letter R</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>rouge</td><td>red</td><td><button onclick="playAudio('rouge')">üîä</button></td></tr>
                    <tr><td>rire</td><td>to laugh</td><td><button onclick="playAudio('rire')">üîä</button></td></tr>
                    <tr><td>rue</td><td>street</td><td><button onclick="playAudio('rue')">üîä</button></td></tr>
                    <tr><td>regarder</td><td>to look</td><td><button onclick="playAudio('regarder')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-s">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter S</h2>
            <div class="letter-pronunciation">S</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> esse (similar to "ess" in English)<br>
                <strong>English Approximation:</strong> ess<br>
                <strong>IPA Symbol:</strong> /…õs/
            </div>
            <button class="master-play" onclick="playLetter('S')">‚ñ∂Ô∏è Play Letter S</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>salut</td><td>hi</td><td><button onclick="playAudio('salut')">üîä</button></td></tr>
                    <tr><td>savoir</td><td>to know</td><td><button onclick="playAudio('savoir')">üîä</button></td></tr>
                    <tr><td>soleil</td><td>sun</td><td><button onclick="playAudio('soleil')">üîä</button></td></tr>
                    <tr><td>soir</td><td>evening</td><td><button onclick="playAudio('soir')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-t">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter T</h2>
            <div class="letter-pronunciation">T</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> t√© (similar to "tay" in English)<br>
                <strong>English Approximation:</strong> tay<br>
                <strong>IPA Symbol:</strong> /te/
            </div>
            <button class="master-play" onclick="playLetter('T')">‚ñ∂Ô∏è Play Letter T</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>tu</td><td>you</td><td><button onclick="playAudio('tu')">üîä</button></td></tr>
                    <tr><td>temps</td><td>time</td><td><button onclick="playAudio('temps')">üîä</button></td></tr>
                    <tr><td>tout</td><td>all</td><td><button onclick="playAudio('tout')">üîä</button></td></tr>
                    <tr><td>travailler</td><td>to work</td><td><button onclick="playAudio('travailler')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-u">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter U</h2>
            <div class="letter-pronunciation">U</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> u (similar to "oo" in English but with pursed lips)<br>
                <strong>English Approximation:</strong> oo<br>
                <strong>IPA Symbol:</strong> /y/<br>
                <strong>Note:</strong> French U is unique - purse your lips as if to say "oo" but say "ee"
            </div>
            <button class="master-play" onclick="playLetter('U')">‚ñ∂Ô∏è Play Letter U</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>un</td><td>one</td><td><button onclick="playAudio('un')">üîä</button></td></tr>
                    <tr><td>une</td><td>a/an</td><td><button onclick="playAudio('une')">üîä</button></td></tr>
                    <tr><td>utile</td><td>useful</td><td><button onclick="playAudio('utile')">üîä</button></td></tr>
                    <tr><td>universit√©</td><td>university</td><td><button onclick="playAudio('universit√©')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-v">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter V</h2>
            <div class="letter-pronunciation">V</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> v√© (similar to "vay" in English)<br>
                <strong>English Approximation:</strong> vay<br>
                <strong>IPA Symbol:</strong> /ve/
            </div>
            <button class="master-play" onclick="playLetter('V')">‚ñ∂Ô∏è Play Letter V</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>vous</td><td>you</td><td><button onclick="playAudio('vous')">üîä</button></td></tr>
                    <tr><td>voir</td><td>to see</td><td><button onclick="playAudio('voir')">üîä</button></td></tr>
                    <tr><td>vert</td><td>green</td><td><button onclick="playAudio('vert')">üîä</button></td></tr>
                    <tr><td>venir</td><td>to come</td><td><button onclick="playAudio('venir')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-w">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter W</h2>
            <div class="letter-pronunciation">W</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> double v√© (similar to "doo-bluh-vay" in English)<br>
                <strong>English Approximation:</strong> doo-bluh-vay<br>
                <strong>IPA Symbol:</strong> /dubl…ô ve/<br>
                <strong>Note:</strong> W is not originally French and appears mainly in borrowed words
            </div>
            <button class="master-play" onclick="playLetter('W')">‚ñ∂Ô∏è Play Letter W</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>week-end</td><td>weekend</td><td><button onclick="playAudio('week-end')">üîä</button></td></tr>
                    <tr><td>web</td><td>web</td><td><button onclick="playAudio('web')">üîä</button></td></tr>
                    <tr><td>wifi</td><td>wifi</td><td><button onclick="playAudio('wifi')">üîä</button></td></tr>
                    <tr><td>wagon</td><td>wagon</td><td><button onclick="playAudio('wagon')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-x">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter X</h2>
            <div class="letter-pronunciation">X</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> ixe (similar to "eeks" in English)<br>
                <strong>English Approximation:</strong> eeks<br>
                <strong>IPA Symbol:</strong> /iks/
            </div>
            <button class="master-play" onclick="playLetter('X')">‚ñ∂Ô∏è Play Letter X</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>exemple</td><td>example</td><td><button onclick="playAudio('exemple')">üîä</button></td></tr>
                    <tr><td>excuser</td><td>to excuse</td><td><button onclick="playAudio('excuser')">üîä</button></td></tr>
                    <tr><td>excellent</td><td>excellent</td><td><button onclick="playAudio('excellent')">üîä</button></td></tr>
                    <tr><td>expliquer</td><td>to explain</td><td><button onclick="playAudio('expliquer')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-y">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter Y</h2>
            <div class="letter-pronunciation">Y</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> i grec (similar to "ee-grek" in English)<br>
                <strong>English Approximation:</strong> ee-grek<br>
                <strong>IPA Symbol:</strong> /i g Å…õk/<br>
                <strong>Note:</strong> Called "Greek i" because it comes from the Greek alphabet
            </div>
            <button class="master-play" onclick="playLetter('Y')">‚ñ∂Ô∏è Play Letter Y</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>yaourt</td><td>yogurt</td><td><button onclick="playAudio('yaourt')">üîä</button></td></tr>
                    <tr><td>yeux</td><td>eyes</td><td><button onclick="playAudio('yeux')">üîä</button></td></tr>
                    <tr><td>yoga</td><td>yoga</td><td><button onclick="playAudio('yoga')">üîä</button></td></tr>
                    <tr><td>yen</td><td>yen</td><td><button onclick="playAudio('yen')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="letter-z">
            <a class="drill-up" href="#alphabet-overview">‚Üë Back to Alphabet Overview</a>
            <h2>Letter Z</h2>
            <div class="letter-pronunciation">Z</div>
            <div class="pronunciation-guide">
                <strong>French Pronunciation:</strong> z√®de (similar to "zed" in English)<br>
                <strong>English Approximation:</strong> zed<br>
                <strong>IPA Symbol:</strong> /z…õd/
            </div>
            <button class="master-play" onclick="playLetter('Z')">‚ñ∂Ô∏è Play Letter Z</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>z√©ro</td><td>zero</td><td><button onclick="playAudio('z√©ro')">üîä</button></td></tr>
                    <tr><td>zone</td><td>zone</td><td><button onclick="playAudio('zone')">üîä</button></td></tr>
                    <tr><td>zoo</td><td>zoo</td><td><button onclick="playAudio('zoo')">üîä</button></td></tr>
                    <tr><td>zeste</td><td>zest</td><td><button onclick="playAudio('zeste')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <!-- French Accents Sections -->
        <div id="french-accents-overview" style="margin-top: 4rem;">
            <h2>French Accents (Les Accents)</h2>
            <div style="text-align: center; margin: 1rem 0;">
                <button class="master-play" onclick="playAllAccents()">‚ñ∂Ô∏è Play All French Accents</button>
            </div>
            <div style="max-width: 800px; margin: 0 auto 1.5rem auto; background: #e0f2fe; border-left: 4px solid #0288d1; padding: 1rem 1.5rem; color: #8b4513; font-size: 1.08rem;">
                <strong>Understanding French Accents</strong><br>
                French accents are diacritical marks that change the pronunciation and meaning of letters. They are essential for proper French spelling, pronunciation, and comprehension. Each accent has specific rules and affects how words are pronounced and understood.<br><br>
                <strong>Accent Tips</strong><br>
                Learning accents is crucial for reading French correctly. Pay attention to how each accent changes the sound of the base letter. Missing accents can completely change word meanings!
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Accent Type</th>
                        <th>Examples</th>
                        <th>Function</th>
                        <th>Go to Details</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Accent Aigu (√©)</td><td>caf√©, √©t√©</td><td>Makes 'e' sound like 'ay'</td><td><a href="#accent-aigu">Go</a></td></tr>
                    <tr><td>Accent Grave (√®, √†, √π)</td><td>m√®re, √†, o√π</td><td>Changes sound; distinguishes words</td><td><a href="#accent-grave">Go</a></td></tr>
                    <tr><td>Circonflexe (√™, √¢, √Æ, √¥, √ª)</td><td>√™tre, √¢ge, √Æle</td><td>Historical; sometimes changes sound</td><td><a href="#accent-circonflexe">Go</a></td></tr>
                    <tr><td>Tr√©ma (√´, √Ø, √º, √ø)</td><td>No√´l, ma√Øs</td><td>Separates vowel sounds</td><td><a href="#accent-trema">Go</a></td></tr>
                    <tr><td>C√©dille (√ß)</td><td>fran√ßais, gar√ßon</td><td>Makes 'c' soft before a, o, u</td><td><a href="#accent-cedille">Go</a></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="accent-aigu">
            <a class="drill-up" href="#french-accents-overview">‚Üë Back to Accents Overview</a>
            <h2>Accent Aigu (√©)</h2>
            <div class="letter-pronunciation">√©</div>
            <div class="pronunciation-guide">
                <strong>Name:</strong> Accent aigu (acute accent)<br>
                <strong>Pronunciation:</strong> Makes 'e' sound like 'ay' in English<br>
                <strong>IPA Symbol:</strong> /e/<br>
                <strong>Usage:</strong> Only appears on the letter 'e' and changes its pronunciation
            </div>
            <button class="master-play" onclick="playAccent('√©')">‚ñ∂Ô∏è Play Accent Aigu</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>caf√©</td><td>coffee</td><td><button onclick="playAudio('caf√©')">üîä</button></td></tr>
                    <tr><td>√©t√©</td><td>summer</td><td><button onclick="playAudio('√©t√©')">üîä</button></td></tr>
                    <tr><td>√©l√©phant</td><td>elephant</td><td><button onclick="playAudio('√©l√©phant')">üîä</button></td></tr>
                    <tr><td>m√©decin</td><td>doctor</td><td><button onclick="playAudio('m√©decin')">üîä</button></td></tr>
                    <tr><td>√©crire</td><td>to write</td><td><button onclick="playAudio('√©crire')">üîä</button></td></tr>
                    <tr><td>t√©l√©vision</td><td>television</td><td><button onclick="playAudio('t√©l√©vision')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="accent-grave">
            <a class="drill-up" href="#french-accents-overview">‚Üë Back to Accents Overview</a>
            <h2>Accent Grave (√®, √†, √π)</h2>
            <div class="letter-pronunciation">√® √† √π</div>
            <div class="pronunciation-guide">
                <strong>Name:</strong> Accent grave (grave accent)<br>
                <strong>Pronunciation:</strong> 
                ‚Ä¢ √® = 'eh' sound (open e)<br>
                ‚Ä¢ √† = same as 'a' but distinguishes meaning<br>
                ‚Ä¢ √π = same as 'u' but distinguishes meaning<br>
                <strong>Usage:</strong> Changes pronunciation (√®) or distinguishes words (√†, √π)
            </div>
            <button class="master-play" onclick="playAccentGrave()">‚ñ∂Ô∏è Play Accent Grave Examples</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>m√®re</td><td>mother</td><td><button onclick="playAudio('m√®re')">üîä</button></td></tr>
                    <tr><td>p√®re</td><td>father</td><td><button onclick="playAudio('p√®re')">üîä</button></td></tr>
                    <tr><td>fr√®re</td><td>brother</td><td><button onclick="playAudio('fr√®re')">üîä</button></td></tr>
                    <tr><td>√†</td><td>to/at</td><td><button onclick="playAudio('√†')">üîä</button></td></tr>
                    <tr><td>l√†</td><td>there</td><td><button onclick="playAudio('l√†')">üîä</button></td></tr>
                    <tr><td>o√π</td><td>where</td><td><button onclick="playAudio('o√π')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="accent-circonflexe">
            <a class="drill-up" href="#french-accents-overview">‚Üë Back to Accents Overview</a>
            <h2>Accent Circonflexe (√™, √¢, √Æ, √¥, √ª)</h2>
            <div class="letter-pronunciation">√™ √¢ √Æ √¥ √ª</div>
            <div class="pronunciation-guide">
                <strong>Name:</strong> Accent circonflexe (circumflex accent)<br>
                <strong>Pronunciation:</strong> 
                ‚Ä¢ √™ = 'eh' sound (like √®)<br>
                ‚Ä¢ √¢ = slightly longer 'ah'<br>
                ‚Ä¢ √Æ = 'ee' sound<br>
                ‚Ä¢ √¥ = 'oh' sound<br>
                ‚Ä¢ √ª = 'oo' sound<br>
                <strong>Usage:</strong> Historical marker; sometimes indicates a lost 's' from old French
            </div>
            <button class="master-play" onclick="playAccentCirconflexe()">‚ñ∂Ô∏è Play Circonflexe Examples</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>√™tre</td><td>to be</td><td><button onclick="playAudio('√™tre')">üîä</button></td></tr>
                    <tr><td>t√™te</td><td>head</td><td><button onclick="playAudio('t√™te')">üîä</button></td></tr>
                    <tr><td>√¢ge</td><td>age</td><td><button onclick="playAudio('√¢ge')">üîä</button></td></tr>
                    <tr><td>p√¢te</td><td>dough/pasta</td><td><button onclick="playAudio('p√¢te')">üîä</button></td></tr>
                    <tr><td>√Æle</td><td>island</td><td><button onclick="playAudio('√Æle')">üîä</button></td></tr>
                    <tr><td>h√¥tel</td><td>hotel</td><td><button onclick="playAudio('h√¥tel')">üîä</button></td></tr>
                    <tr><td>s√ªr</td><td>sure</td><td><button onclick="playAudio('s√ªr')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="accent-trema">
            <a class="drill-up" href="#french-accents-overview">‚Üë Back to Accents Overview</a>
            <h2>Tr√©ma (√´, √Ø, √º, √ø)</h2>
            <div class="letter-pronunciation">√´ √Ø √º √ø</div>
            <div class="pronunciation-guide">
                <strong>Name:</strong> Tr√©ma (diaeresis/umlaut)<br>
                <strong>Pronunciation:</strong> Each vowel is pronounced separately<br>
                <strong>Function:</strong> Indicates that adjacent vowels should be pronounced separately, not as a diphthong<br>
                <strong>Usage:</strong> Prevents vowel combinations from creating single sounds
            </div>
            <button class="master-play" onclick="playAccentTrema()">‚ñ∂Ô∏è Play Tr√©ma Examples</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>No√´l</td><td>Christmas</td><td><button onclick="playAudio('No√´l')">üîä</button></td></tr>
                    <tr><td>na√Øve</td><td>naive</td><td><button onclick="playAudio('na√Øve')">üîä</button></td></tr>
                    <tr><td>ma√Øs</td><td>corn</td><td><button onclick="playAudio('ma√Øs')">üîä</button></td></tr>
                    <tr><td>co√Øncidence</td><td>coincidence</td><td><button onclick="playAudio('co√Øncidence')">üîä</button></td></tr>
                    <tr><td>aigu√´</td><td>acute (feminine)</td><td><button onclick="playAudio('aigu√´')">üîä</button></td></tr>
                    <tr><td>Capharna√ºm</td><td>chaos</td><td><button onclick="playAudio('Capharna√ºm')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <div class="letter-section" id="accent-cedille">
            <a class="drill-up" href="#french-accents-overview">‚Üë Back to Accents Overview</a>
            <h2>C√©dille (√ß)</h2>
            <div class="letter-pronunciation">√ß</div>
            <div class="pronunciation-guide">
                <strong>Name:</strong> C√©dille (cedilla)<br>
                <strong>Pronunciation:</strong> Makes 'c' sound like 's'<br>
                <strong>IPA Symbol:</strong> /s/<br>
                <strong>Usage:</strong> Used with 'c' before 'a', 'o', 'u' to maintain the soft 's' sound<br>
                <strong>Rule:</strong> Without cedilla, 'c' before 'a', 'o', 'u' would sound like 'k'
            </div>
            <button class="master-play" onclick="playAccent('√ß')">‚ñ∂Ô∏è Play C√©dille</button>
            <table>
                <thead>
                    <tr><th>French Examples</th><th>English Translation</th><th>Audio</th></tr>
                </thead>
                <tbody>
                    <tr><td>fran√ßais</td><td>French</td><td><button onclick="playAudio('fran√ßais')">üîä</button></td></tr>
                    <tr><td>gar√ßon</td><td>boy</td><td><button onclick="playAudio('gar√ßon')">üîä</button></td></tr>
                    <tr><td>le√ßon</td><td>lesson</td><td><button onclick="playAudio('le√ßon')">üîä</button></td></tr>
                    <tr><td>fa√ßon</td><td>way</td><td><button onclick="playAudio('fa√ßon')">üîä</button></td></tr>
                    <tr><td>re√ßu</td><td>received</td><td><button onclick="playAudio('re√ßu')">üîä</button></td></tr>
                    <tr><td>√ßa</td><td>that</td><td><button onclick="playAudio('√ßa')">üîä</button></td></tr>
                </tbody>
            </table>
        </div>

        <p style="text-align:center; margin-top:3rem; color:#666;">
            Complete French alphabet and accents with detailed pronunciation guides and examples.<br>
            <a href="#top">Back to Top</a> | 
            <a href="index.html">Home</a> | 
            <a href="#" onclick="return handleNumbersAccess(event, 'French-Numbers.html')">French Numbers üíé</a> | 
            <a href="French-Verbs.html">French Verbs</a>
        </p>
    </div>

    <script>
        // Dropdown functionality
        function toggleDropdown(event, dropdownId) {
            event.preventDefault();
            event.stopPropagation();
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                if (dropdown.id !== dropdownId) {
                    dropdown.classList.remove('show');
                    dropdown.parentElement.classList.remove('active');
                }
            });
            
            // Toggle the clicked dropdown
            const dropdown = document.getElementById(dropdownId);
            const dropdownParent = dropdown.parentElement;
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                dropdownParent.classList.remove('active');
            } else {
                dropdown.classList.add('show');
                dropdownParent.classList.add('active');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.matches('.dropdown-toggle') && !event.target.matches('.dropdown-arrow')) {
                document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                    dropdown.classList.remove('show');
                    dropdown.parentElement.classList.remove('active');
                });
            }
        });

        // Sidebar expand/collapse functionality
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.textContent = '‚ñ∂';
            } else {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                icon.textContent = '‚ñº';
            }
        }

        // Add French accent data
        window.accentData = {
            'accent-aigu': {
                name: 'Accent Aigu',
                symbol: '√©',
                description: 'Makes e sound like ay',
                examples: ['Caf√© (coffee)', '√ât√© (summer)', '√âl√©phant (elephant)', 'M√©decin (doctor)', '√âcrire (to write)', 'T√©l√©vision (television)']
            },
            'accent-grave': {
                name: 'Accent Grave',
                symbol: '√® √† √π',
                description: 'Changes sound or distinguishes words',
                examples: ['M√®re (mother)', 'P√®re (father)', 'Fr√®re (brother)', '√Ä (to/at)', 'L√† (there)', 'O√π (where)']
            },
            'accent-circonflexe': {
                name: 'Accent Circonflexe',
                symbol: '√™ √¢ √Æ √¥ √ª',
                description: 'Historical marker, sometimes changes sound',
                examples: ['√ätre (to be)', 'T√™te (head)', '√Çge (age)', 'P√¢te (dough)', '√éle (island)', 'H√¥tel (hotel)', 'S√ªr (sure)']
            },
            'accent-trema': {
                name: 'Tr√©ma',
                symbol: '√´ √Ø √º √ø',
                description: 'Separates vowel sounds',
                examples: ['No√´l (Christmas)', 'Na√Øve (naive)', 'Ma√Øs (corn)', 'Co√Øncidence (coincidence)', 'Aigu√´ (acute feminine)', 'Capharna√ºm (chaos)']
            },
            'accent-cedille': {
                name: 'C√©dille',
                symbol: '√ß',
                description: 'Makes c soft before a, o, u',
                examples: ['Fran√ßais (French)', 'Gar√ßon (boy)', 'Le√ßon (lesson)', 'Fa√ßon (way)', 'Re√ßu (received)', '√áa (that)']
            }
        };

        // Add French alphabet data
        window.alphabetData = {
            'letter-a': {
                letter: 'A',
                french: 'a',
                english: 'ah',
                examples: ['Arbre (tree)', 'Ami (friend)', 'Auto (car)', 'Avion (airplane)'],
                pronunciation: 'a'
            },
            'letter-b': {
                letter: 'B',
                french: 'b√©',
                english: 'bay',
                examples: ['Bonjour (hello)', 'Bleu (blue)', 'Boire (to drink)', 'Beau (beautiful)'],
                pronunciation: 'b√©'
            },
            'letter-c': {
                letter: 'C',
                french: 'c√©',
                english: 'say',
                examples: ['Chat (cat)', 'Caf√© (coffee)', 'Cours (class)', 'Ciel (sky)'],
                pronunciation: 'c√©'
            },
            'letter-d': {
                letter: 'D',
                french: 'd√©',
                english: 'day',
                examples: ['Deux (two)', 'Dire (to say)', 'Doux (soft)', 'Donner (to give)'],
                pronunciation: 'd√©'
            },
            'letter-e': {
                letter: 'E',
                french: 'e',
                english: 'euh',
                examples: ['√âcole (school)', '√ätre (to be)', 'Eau (water)', 'Elle (she)'],
                pronunciation: 'e'
            },
            'letter-f': {
                letter: 'F',
                french: 'effe',
                english: 'eff',
                examples: ['Fran√ßais (French)', 'Faire (to do)', 'Fille (girl)', 'Froid (cold)'],
                pronunciation: 'effe'
            },
            'letter-g': {
                letter: 'G',
                french: 'g√©',
                english: 'zhay',
                examples: ['Grand (big)', 'Gare (station)', 'Gens (people)', 'Go√ªt (taste)'],
                pronunciation: 'g√©'
            },
            'letter-h': {
                letter: 'H',
                french: 'ache',
                english: 'ahsh',
                examples: ['Heure (hour)', 'Homme (man)', 'H√¥tel (hotel)', 'Hier (yesterday)'],
                pronunciation: 'ache'
            },
            'letter-i': {
                letter: 'I',
                french: 'i',
                english: 'ee',
                examples: ['Ici (here)', 'Il (he)', 'Id√©e (idea)', 'Image (image)'],
                pronunciation: 'i'
            },
            'letter-j': {
                letter: 'J',
                french: 'ji',
                english: 'zhee',
                examples: ['Je (I)', 'Jour (day)', 'Joli (pretty)', 'Jouer (to play)'],
                pronunciation: 'ji'
            },
            'letter-k': {
                letter: 'K',
                french: 'ka',
                english: 'kah',
                examples: ['Kilo (kilogram)', 'Kayak (kayak)', 'Kiwi (kiwi)', 'Karat√© (karate)'],
                pronunciation: 'ka'
            },
            'letter-l': {
                letter: 'L',
                french: 'elle',
                english: 'ell',
                examples: ['Lire (to read)', 'Livre (book)', 'Lieu (place)', 'Lundi (Monday)'],
                pronunciation: 'elle'
            },
            'letter-m': {
                letter: 'M',
                french: 'emme',
                english: 'emm',
                examples: ['Maman (mom)', 'Manger (to eat)', 'Maison (house)', 'Monde (world)'],
                pronunciation: 'emme'
            },
            'letter-n': {
                letter: 'N',
                french: 'enne',
                english: 'enn',
                examples: ['Non (no)', 'Nom (name)', 'Nouveau (new)', 'Noir (black)'],
                pronunciation: 'enne'
            },
            'letter-o': {
                letter: 'O',
                french: 'o',
                english: 'oh',
                examples: ['O√π (where)', 'Oui (yes)', 'Ouvrir (to open)', 'Orange (orange)'],
                pronunciation: 'o'
            },
            'letter-p': {
                letter: 'P',
                french: 'p√©',
                english: 'pay',
                examples: ['Papa (dad)', 'Parler (to speak)', 'Petit (small)', 'Pouvoir (can)'],
                pronunciation: 'p√©'
            },
            'letter-q': {
                letter: 'Q',
                french: 'cu',
                english: 'koo',
                examples: ['Que (what)', 'Qui (who)', 'Quand (when)', 'Quatre (four)'],
                pronunciation: 'cu'
            },
            'letter-r': {
                letter: 'R',
                french: 'erre',
                english: 'err',
                examples: ['Rouge (red)', 'Rire (to laugh)', 'Rue (street)', 'Regarder (to look)'],
                pronunciation: 'erre'
            },
            'letter-s': {
                letter: 'S',
                french: 'esse',
                english: 'ess',
                examples: ['Salut (hi)', 'Savoir (to know)', 'Soleil (sun)', 'Soir (evening)'],
                pronunciation: 'esse'
            },
            'letter-t': {
                letter: 'T',
                french: 't√©',
                english: 'tay',
                examples: ['Tu (you)', 'Temps (time)', 'Tout (all)', 'Travailler (to work)'],
                pronunciation: 't√©'
            },
            'letter-u': {
                letter: 'U',
                french: 'u',
                english: 'oo',
                examples: ['Un (one)', 'Une (a/an)', 'Utile (useful)', 'Universit√© (university)'],
                pronunciation: 'u'
            },
            'letter-v': {
                letter: 'V',
                french: 'v√©',
                english: 'vay',
                examples: ['Vous (you)', 'Voir (to see)', 'Vert (green)', 'Venir (to come)'],
                pronunciation: 'v√©'
            },
            'letter-w': {
                letter: 'W',
                french: 'double v√©',
                english: 'doo-bluh-vay',
                examples: ['Week-end (weekend)', 'Web (web)', 'Wifi (wifi)', 'Wagon (wagon)'],
                pronunciation: 'double v√©'
            },
            'letter-x': {
                letter: 'X',
                french: 'ixe',
                english: 'eeks',
                examples: ['Exemple (example)', 'Excuser (to excuse)', 'Excellent (excellent)', 'Expliquer (to explain)'],
                pronunciation: 'ixe'
            },
            'letter-y': {
                letter: 'Y',
                french: 'i grec',
                english: 'ee-grek',
                examples: ['Yaourt (yogurt)', 'Yeux (eyes)', 'Yoga (yoga)', 'Yen (yen)'],
                pronunciation: 'i grec'
            },
            'letter-z': {
                letter: 'Z',
                french: 'z√®de',
                english: 'zed',
                examples: ['Z√©ro (zero)', 'Zone (zone)', 'Zoo (zoo)', 'Zeste (zest)'],
                pronunciation: 'z√®de'
            }
        };

        // Get best French voice (same as main file)
        function getBestFrenchVoice() {
            const voices = window.speechSynthesis.getVoices();
            // Always prefer Microsoft Claude - French (Canada) if available
            let claude = voices.find(v => v.name === 'Microsoft Claude - French (Canada)');
            if (claude) return claude;
            // Fallbacks
            let frCaVoices = voices.filter(v => v.lang === 'fr-CA');
            if (frCaVoices.length > 0) return frCaVoices[0];
            let frVoices = voices.filter(v => v.lang.startsWith('fr'));
            if (frVoices.length > 0) return frVoices[0];
            return null;
        }

        // Highlight word function
        function highlightWord(word) {
            // Remove any existing highlights
            document.querySelectorAll('.word-highlight').forEach(el => {
                el.classList.remove('word-highlight');
            });
            
            // Find and highlight the word in tables
            const tables = document.querySelectorAll('table');
            tables.forEach(table => {
                const cells = table.querySelectorAll('td');
                cells.forEach(cell => {
                    const cellText = cell.textContent.trim();
                    const searchWord = word.trim();
                    
                    // Try exact match (case sensitive and insensitive)
                    if (cellText === searchWord || cellText.toLowerCase() === searchWord.toLowerCase()) {
                        cell.classList.add('word-highlight');
                    }
                    // Try partial match only for specific cases (avoid over-highlighting)
                    else if (searchWord.length > 2 && (cellText.includes(searchWord) || cellText.toLowerCase().includes(searchWord.toLowerCase()))) {
                        cell.classList.add('word-highlight');
                    }
                });
            });
        }

        // Remove highlight function
        function removeHighlight() {
            document.querySelectorAll('.word-highlight').forEach(el => {
                el.classList.remove('word-highlight');
            });
        }

        // Audio function for pronunciation (same as main file)
        function playAudio(text) {
            // Highlight the word
            highlightWord(text);
            
            const utterance = new SpeechSynthesisUtterance(text);
            const voice = getBestFrenchVoice();
            if (voice) utterance.voice = voice;
            utterance.lang = voice ? voice.lang : 'fr-CA';
            utterance.rate = 0.8; // Medium-slow rate for clarity
            
            // Remove highlight when audio ends
            utterance.onend = function() {
                setTimeout(removeHighlight, 200);
            };
            
            window.speechSynthesis.speak(utterance);
        }

        function playLetter(letter) {
            playAudio(letter);
        }

        // Play entire French alphabet (same as main file)
        function playEntireAlphabet() {
            const alphabetLetters = Object.values(window.alphabetData);
            let idx = 0;
            function speakNext() {
                if (idx < alphabetLetters.length) {
                    // Highlight current letter
                    highlightWord(alphabetLetters[idx].french);
                    
                    const utterance = new SpeechSynthesisUtterance(alphabetLetters[idx].french);
                    const voice = getBestFrenchVoice();
                    if (voice) utterance.voice = voice;
                    utterance.lang = voice ? voice.lang : 'fr-CA';
                    utterance.rate = 0.6; // Slower rate for learning
                    utterance.onend = function() {
                        idx++;
                        if (idx >= alphabetLetters.length) {
                            // Remove highlight when all done
                            setTimeout(removeHighlight, 200);
                            return; // Exit here to prevent calling speakNext() again
                        }
                        // Small pause between letters
                        setTimeout(speakNext, 800);
                    };
                    window.speechSynthesis.speak(utterance);
                }
            }
            window.speechSynthesis.cancel();
            removeHighlight(); // Clear any existing highlights
            
            // Ensure voices are loaded before starting
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = function() {
                    // Clear the event handler to prevent multiple calls
                    window.speechSynthesis.onvoiceschanged = null;
                    speakNext();
                };
            } else {
                speakNext();
            }
        }

        // Play single accent
        function playAccent(accent) {
            playAudio(accent);
        }

        // Play accent grave examples (√®, √†, √π)
        function playAccentGrave() {
            const examples = ['√®', '√†', '√π'];
            let idx = 0;
            function speakNext() {
                if (idx < examples.length) {
                    const utterance = new SpeechSynthesisUtterance(examples[idx]);
                    const voice = getBestFrenchVoice();
                    if (voice) utterance.voice = voice;
                    utterance.lang = voice ? voice.lang : 'fr-CA';
                    utterance.rate = 0.7;
                    utterance.onend = function() {
                        idx++;
                        if (idx >= examples.length) {
                            return; // Exit here to prevent calling speakNext() again
                        }
                        setTimeout(speakNext, 600);
                    };
                    window.speechSynthesis.speak(utterance);
                }
            }
            window.speechSynthesis.cancel();
            
            // Ensure voices are loaded before starting
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = function() {
                    // Clear the event handler to prevent multiple calls
                    window.speechSynthesis.onvoiceschanged = null;
                    speakNext();
                };
            } else {
                speakNext();
            }
        }

        // Play circonflexe examples
        function playAccentCirconflexe() {
            const examples = ['√™', '√¢', '√Æ', '√¥', '√ª'];
            let idx = 0;
            function speakNext() {
                if (idx < examples.length) {
                    const utterance = new SpeechSynthesisUtterance(examples[idx]);
                    const voice = getBestFrenchVoice();
                    if (voice) utterance.voice = voice;
                    utterance.lang = voice ? voice.lang : 'fr-CA';
                    utterance.rate = 0.7;
                    utterance.onend = function() {
                        idx++;
                        if (idx >= examples.length) {
                            return; // Exit here to prevent calling speakNext() again
                        }
                        setTimeout(speakNext, 600);
                    };
                    window.speechSynthesis.speak(utterance);
                }
            }
            window.speechSynthesis.cancel();
            
            // Ensure voices are loaded before starting
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = function() {
                    // Clear the event handler to prevent multiple calls
                    window.speechSynthesis.onvoiceschanged = null;
                    speakNext();
                };
            } else {
                speakNext();
            }
        }

        // Play tr√©ma examples
        function playAccentTrema() {
            const examples = ['√´', '√Ø', '√º', '√ø'];
            let idx = 0;
            function speakNext() {
                if (idx < examples.length) {
                    const utterance = new SpeechSynthesisUtterance(examples[idx]);
                    const voice = getBestFrenchVoice();
                    if (voice) utterance.voice = voice;
                    utterance.lang = voice ? voice.lang : 'fr-CA';
                    utterance.rate = 0.7;
                    utterance.onend = function() {
                        idx++;
                        if (idx >= examples.length) {
                            return; // Exit here to prevent calling speakNext() again
                        }
                        setTimeout(speakNext, 600);
                    };
                    window.speechSynthesis.speak(utterance);
                }
            }
            window.speechSynthesis.cancel();
            
            // Ensure voices are loaded before starting
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = function() {
                    // Clear the event handler to prevent multiple calls
                    window.speechSynthesis.onvoiceschanged = null;
                    speakNext();
                };
            } else {
                speakNext();
            }
        }

        // Play all French accents
        function playAllAccents() {
            const accentExamples = ['√©', '√®', '√†', '√π', '√™', '√¢', '√Æ', '√¥', '√ª', '√´', '√Ø', '√º', '√ø', '√ß'];
            let idx = 0;
            function speakNext() {
                if (idx < accentExamples.length) {
                    // Highlight current accent
                    highlightWord(accentExamples[idx]);
                    
                    const utterance = new SpeechSynthesisUtterance(accentExamples[idx]);
                    const voice = getBestFrenchVoice();
                    if (voice) utterance.voice = voice;
                    utterance.lang = voice ? voice.lang : 'fr-CA';
                    utterance.rate = 0.6;
                    utterance.onend = function() {
                        idx++;
                        if (idx >= accentExamples.length) {
                            // Remove highlight when all done
                            setTimeout(removeHighlight, 200);
                            return; // Exit here to prevent calling speakNext() again
                        }
                        setTimeout(speakNext, 700);
                    };
                    window.speechSynthesis.speak(utterance);
                }
            }
            window.speechSynthesis.cancel();
            removeHighlight(); // Clear any existing highlights
            
            // Ensure voices are loaded before starting
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.onvoiceschanged = function() {
                    // Clear the event handler to prevent multiple calls
                    window.speechSynthesis.onvoiceschanged = null;
                    speakNext();
                };
            } else {
                speakNext();
            }
        }

        // Comprehensive search functionality
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            const resultsContainer = document.getElementById('searchResults');
            
            if (!searchTerm) {
                resultsContainer.classList.remove('show');
                return;
            }

            // All searchable alphabet and accent items
            const searchableContent = [];
            
            // Add alphabet items
            Object.keys(window.alphabetData).forEach(letterId => {
                const data = window.alphabetData[letterId];
                searchableContent.push({
                    title: `Letter ${data.letter}`,
                    content: `French pronunciation: ${data.french} (${data.english})`,
                    link: `#${letterId}`,
                    category: 'French Alphabets'
                });
                
                // Add examples as searchable content
                data.examples.forEach(example => {
                    const [french, english] = example.split(' (');
                    searchableContent.push({
                        title: french,
                        content: `Example for letter ${data.letter}: ${example}`,
                        link: `#${letterId}`,
                        category: 'French Words'
                    });
                });
            });

            // Add accent items
            Object.keys(window.accentData).forEach(accentId => {
                const data = window.accentData[accentId];
                searchableContent.push({
                    title: `${data.name} (${data.symbol})`,
                    content: `French accent: ${data.description}`,
                    link: `#${accentId}`,
                    category: 'French Accents'
                });
                
                // Add accent examples as searchable content
                data.examples.forEach(example => {
                    const [french, english] = example.split(' (');
                    searchableContent.push({
                        title: french,
                        content: `Example for ${data.name}: ${example}`,
                        link: `#${accentId}`,
                        category: 'French Words with Accents'
                    });
                });
            });

            // Perform search
            const results = searchableContent.filter(item => 
                item.title.toLowerCase().includes(searchTerm) || 
                item.content.toLowerCase().includes(searchTerm)
            );

            if (results.length > 0) {
                resultsContainer.innerHTML = results.map(result => 
                    `<div class="search-result-item" onclick="window.location.href='${result.link}'">
                        <strong>${result.title}</strong> - ${result.category}<br>
                        <small>${result.content}</small>
                    </div>`
                ).join('');
                resultsContainer.classList.add('show');
            } else {
                resultsContainer.innerHTML = '<div class="search-no-results">No results found for "' + searchTerm + '"</div>';
                resultsContainer.classList.add('show');
            }
        }

        // Allow search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Hide results when clicking outside
        document.addEventListener('click', function(e) {
            const searchContainer = document.querySelector('.search-container');
            if (!searchContainer.contains(e.target)) {
                document.getElementById('searchResults').classList.remove('show');
            }
        });

        // Mobile menu toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        // Navigation helper
        window.navigateToModule = function(url) {
            window.location.href = url;
        };

        // Authentication Functions
        function toggleAuthButtons(isSignedIn, userName = '', subscriptionStatus = 'free') {
            console.log('üîÑ toggleAuthButtons called:', { isSignedIn, userName, subscriptionStatus });
            
            const authButtons = document.querySelector('.auth-buttons');
            const userStatus = document.getElementById('userStatus');
            const userGreeting = document.getElementById('userGreeting');
            const subscriptionStatusSpan = document.getElementById('subscriptionStatus');
            const signOutBtn = document.getElementById('signOutBtn');
            const donateBtn = document.querySelector('.nav-donate');
            
            if (isSignedIn) {
                // User is signed in - show user status and hide sign in/up buttons
                console.log('üë§ Showing user status for:', userName);
                
                // Validate userName to prevent password from being displayed
                const displayName = (userName && typeof userName === 'string' && userName.trim() && !userName.includes('@')) 
                    ? userName.trim() 
                    : 'User';
                
                if (authButtons) {
                    const signInBtn = authButtons.querySelector('.sign-in-btn');
                    const signUpBtn = authButtons.querySelector('.sign-up-btn');
                    if (signInBtn) signInBtn.style.display = 'none';
                    if (signUpBtn) signUpBtn.style.display = 'none';
                }
                
                if (userStatus) userStatus.style.display = 'flex';
                if (userGreeting) userGreeting.textContent = `Welcome, ${displayName}!`;
                if (signOutBtn) signOutBtn.style.display = 'inline-block';
                // Show Support Us button only for premium users
                if (donateBtn) {
                    if (subscriptionStatus === 'premium') {
                        donateBtn.style.display = 'block';
                        console.log('‚úÖ Support Us button shown for premium user');
                    } else {
                        donateBtn.style.display = 'none';
                        console.log('‚ùå Support Us button hidden for non-premium user');
                    }
                }
                
                // Handle subscription button based on premium status (direct logic like other pages)
                const subscriptionBtn = document.getElementById('subscriptionBtn');
                if (subscriptionBtn) {
                    if (subscriptionStatus === 'premium') {
                        console.log('üéØ Direct premium check - hiding Go Premium button');
                        subscriptionBtn.style.display = 'none';
                    } else {
                        console.log('üéØ Direct non-premium check - showing Go Premium button');
                        subscriptionBtn.style.display = 'inline-flex';
                        subscriptionBtn.textContent = 'üíé Go Premium';
                    }
                }
                
                // Update subscription status
                updateSubscriptionUI(subscriptionStatus);
                
            } else {
                // User is signed out - show sign in/up buttons and hide user status
                console.log('üö™ Hiding user status, showing sign in/up buttons');
                
                if (authButtons) {
                    const signInBtn = authButtons.querySelector('.sign-in-btn');
                    const signUpBtn = authButtons.querySelector('.sign-up-btn');
                    if (signInBtn) signInBtn.style.display = 'inline-block';
                    if (signUpBtn) signUpBtn.style.display = 'inline-block';
                }
                
                if (userStatus) userStatus.style.display = 'none';
                if (signOutBtn) signOutBtn.style.display = 'none';
                if (donateBtn) donateBtn.style.display = 'none'; // Hide Support Us button when signed out
                
                // Reset user name and subscription status to default guest state
                if (userGreeting) userGreeting.textContent = 'Welcome!';
                
                // Force reset subscription UI to free/guest state
                if (subscriptionStatusSpan) {
                    subscriptionStatusSpan.textContent = 'Free';
                    subscriptionStatusSpan.className = 'subscription-status free';
                }
                
                // Show Go Premium button for signed-out users
                updateSubscriptionUI('free');
                
                console.log('‚úÖ UI reset to guest state');
            }
        }

        // Function to check if current user has premium access
        function isPremiumUser() {
            const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || 'null');
            return currentUser && currentUser.subscription?.status === 'premium';
        }

        // Function to handle numbers feature access
        function handleNumbersAccess(event, targetUrl = null) {
            event.preventDefault();
            
            // Default targetUrl if none provided - this fixes the main menu link navigation
            if (!targetUrl) {
                targetUrl = 'French-Numbers.html';
            }
            
            console.log('üî¢ handleNumbersAccess called from French-Alphabets.html:', {
                hasTargetUrl: !!targetUrl,
                targetUrl: targetUrl,
                clickedElement: event.target.textContent.trim()
            });
            
            const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || 'null');
            
            if (!currentUser) {
                // Not signed in
                console.log('‚ùå User not signed in');
                alert('üîê Please sign in first to access French Numbers.\n\nThis is a premium feature that requires an account.');
                window.location.href = 'index.html';
                return false;
            }
            
            console.log('üë§ User found:', {
                email: currentUser.email,
                subscriptionStatus: currentUser.subscription?.status
            });
            
            if (currentUser.subscription?.status === 'premium') {
                // Premium user - allow access
                console.log('‚úÖ Premium user detected, navigating to:', targetUrl);
                
                try {
                    // Multiple navigation methods for reliability
                    if (targetUrl) {
                        console.log('üöÄ Attempting navigation...');
                        
                        // Method 1: Direct navigation
                        window.location.href = targetUrl;
                        
                        // Method 2: Fallback with timeout
                        setTimeout(() => {
                            if (window.location.href.indexOf(targetUrl) === -1) {
                                console.log('üîÑ Fallback navigation attempt...');
                                window.location.assign(targetUrl);
                            }
                        }, 100);
                        
                        console.log('‚úÖ Navigation initiated successfully');
                    } else {
                        console.log('‚ùå No targetUrl provided for navigation');
                    }
                } catch (error) {
                    console.error('‚ùå Navigation error:', error);
                    alert('Navigation error occurred. Please try refreshing the page.');
                }
                
                return true;
            } else {
                // Free user - show premium prompt
                console.log('üîí Free user, showing premium prompt');
                alert('üîí Premium Feature Required\n\n"French Numbers" is available exclusively for Premium subscribers.\n\nUpgrade to Premium to unlock:\n\n‚ú® Complete French Numbers (1-100)\n‚ú® Pronunciation guides\n‚ú® Interactive exercises\n‚ú® Audio practice\n‚ú® All future content updates');
                
                // Open subscription modal directly
                openSubscriptionModal();
                return false;
            }
        }

        // Function to update menu access based on subscription status
        function updateMenuAccess() {
            const isSignedIn = JSON.parse(localStorage.getItem('french_app_current_user') || 'null') !== null;
            const isPremium = isPremiumUser();
            
            // Get numbers menu elements
            const numbersLinks = document.querySelectorAll('[data-feature="numbers"] a, [data-feature="numbers-submenu"] a');
            
            if (numbersLinks.length > 0) {
                // Remove existing classes
                numbersLinks.forEach(link => {
                    link.classList.remove('premium-feature', 'premium-locked');
                });
                
                if (!isSignedIn) {
                    // Not signed in - show locked state
                    numbersLinks.forEach(link => {
                        link.classList.add('premium-locked');
                        link.title = 'Please sign in to access this premium feature';
                    });
                } else if (isPremium) {
                    // Premium user - full access with premium styling
                    numbersLinks.forEach(link => {
                        link.classList.add('premium-feature');
                        link.title = 'French Numbers - Premium Feature (You have access)';
                    });
                } else {
                    // Free user - show locked premium state
                    numbersLinks.forEach(link => {
                        link.classList.add('premium-locked');
                        link.title = 'Premium Feature - Click to upgrade and unlock French Numbers';
                    });
                }
            }
        }

        // SECURITY FIX: Removed auto-fix function that granted unauthorized premium access
        // This function was bypassing payment validation and should not exist
        function autoFixNumbersAccess() {
            console.log('üîí Auto-fix function disabled for security - use proper payment verification');
            // No automatic premium access granted
            updateMenuAccess(); // Only update menu based on actual subscription status
        }

        // Check if user is already signed in when page loads
        window.addEventListener('load', function() {
            const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || 'null');
            if (currentUser) {
                console.log('üë§ User found on page load:', {
                    email: currentUser.email,
                    subscriptionStatus: currentUser.subscription?.status
                });
                
                // Pass subscription status to toggleAuthButtons
                toggleAuthButtons(true, currentUser.name, currentUser.subscription?.status || 'free');
                
                // Force menu access update after a short delay to ensure DOM is ready
                setTimeout(() => {
                    console.log('üèÅ Page loaded, checking premium access...');
                    if (currentUser.subscription?.status === 'premium') {
                        console.log('üëë Premium user detected on page load, ensuring menu access...');
                        updateMenuAccess();
                    }
                }, 500);
            } else {
                console.log('üö∂ No user found on page load - guest mode');
            }
            updateMenuAccess();
            
            // SECURITY FIX: Removed automatic premium access bypass
            // Premium access should only be granted through proper payment verification
        });

        // Handle browser navigation (back/forward buttons)
        window.addEventListener('pageshow', function(event) {
            console.log('üîÑ pageshow event fired - syncing auth state');
            
            // Check auth state when page is shown (including back navigation)
            const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || 'null');
            if (currentUser) {
                console.log('üë§ User found on pageshow:', {
                    email: currentUser.email,
                    subscriptionStatus: currentUser.subscription?.status
                });
                toggleAuthButtons(true, currentUser.name, currentUser.subscription?.status || 'free');
                updateMenuAccess();
            } else {
                console.log('üö∂ No user found on pageshow - guest mode');
                toggleAuthButtons(false);
                updateMenuAccess();
            }
        });

        // Simple authentication functions (will be enhanced with Firebase)
        function openSignInModal() {
            document.getElementById('signInModal').style.display = 'block';
            clearMessages();
        }

        function openSignUpModal() {
            document.getElementById('signUpModal').style.display = 'block';
            clearMessages();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            clearMessages();
        }

        function switchToSignIn() {
            closeModal('signUpModal');
            openSignInModal();
        }

        function switchToSignUp() {
            closeModal('signInModal');
            openSignUpModal();
        }

        function clearMessages() {
            document.querySelectorAll('.error-message, .success-message').forEach(msg => {
                msg.style.display = 'none';
                msg.textContent = '';
            });
        }

        function openSubscriptionModal() {
            console.log('üéØ Opening subscription modal...');
            
            // Check both Firebase auth and localStorage for current user
            const localUser = JSON.parse(localStorage.getItem('french_app_current_user') || 'null');
            const firebaseUser = (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) ? firebase.auth().currentUser : null;
            
            if (!localUser && !firebaseUser) {
                alert('Please sign in first to subscribe.');
                openSignInModal();
                return;
            }
            
            // If Firebase user exists but localStorage doesn't, sync them
            if (firebaseUser && !localUser) {
                const userData = {
                    email: firebaseUser.email,
                    name: firebaseUser.displayName || firebaseUser.email,
                    registeredAt: new Date().toISOString(),
                    subscription: {
                        status: 'free',
                        plan: null,
                        startDate: null,
                        endDate: null
                    }
                };
                localStorage.setItem('french_app_current_user', JSON.stringify(userData));
            }
            
            // Reset modal state
            selectedPlan = null;
            document.querySelectorAll('.plan-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('paymentSection').style.display = 'none';
            
            // Update pricing based on user's country before showing modal
            updateSubscriptionPricingForUser().catch(error => {
                console.error('‚ùå Error updating subscription pricing:', error);
            });
            
            // Update button text to show correct currency immediately
            updatePaymentButtonCurrency().catch(error => {
                console.error('‚ùå Error updating payment button currency:', error);
            });
            
            // Show modal
            document.getElementById('subscriptionModal').style.display = 'block';
            clearMessages();
            
            // Show helpful message
            showSuccess('subscriptionSuccess', 'üëÜ Please select a plan above to continue with payment');
            
            // Initialize Stripe if not already done
            if (!stripe) {
                initializeStripe();
            }
        }

        // Country-specific pricing functions (Enhanced Firebase integration)
        async function getUserCurrency() {
            try {
                // First, try to get country from Firebase Firestore
                const firebaseUser = (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) ? firebase.auth().currentUser : null;
                
                if (firebaseUser && typeof firebase.firestore !== 'undefined') {
                    console.log('üîç Checking Firebase for country data for user:', firebaseUser.uid);
                    
                    try {
                        const doc = await firebase.firestore().collection('users').doc(firebaseUser.uid).get();
                        if (doc.exists) {
                            const userData = doc.data();
                            const firebaseCountry = userData.country;
                            
                            console.log('üåç Firebase country data:', firebaseCountry);
                            
                            if (firebaseCountry) {
                                // Update localStorage with Firebase data
                                const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || '{}');
                                currentUser.country = firebaseCountry;
                                localStorage.setItem('french_app_current_user', JSON.stringify(currentUser));
                                
                                if (firebaseCountry === 'Canada') {
                                    console.log('üí∞ Using CAD currency for Canada (from Firebase)');
                                    return 'CAD';
                                } else if (firebaseCountry === 'India') {
                                    console.log('üí∞ Using INR currency for India (from Firebase)');
                                    return 'INR';
                                }
                            }
                        }
                    } catch (firebaseError) {
                        console.log('‚ö†Ô∏è Firebase query failed, falling back to localStorage:', firebaseError.message);
                    }
                }
                
                // Fallback to localStorage
                const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || '{}');
                console.log('üí∞ Getting user currency from localStorage for:', currentUser.country);
                
                if (currentUser.country === 'Canada') {
                    return 'CAD';
                } else if (currentUser.country === 'India') {
                    return 'INR';
                }
                
                // Default to USD for other countries or if no country specified
                console.log('üí∞ Using USD currency (default/fallback)');
                return 'USD';
                
            } catch (error) {
                console.error('‚ùå Error in getUserCurrency:', error);
                return 'USD';
            }
        }

        async function updateSubscriptionPricingForUser() {
            try {
                const currency = await getUserCurrency();
                
                console.log('üéØ Updating subscription pricing for currency:', currency);
                
                if (currency === 'CAD') {
                    console.log('üçÅ Applying Canadian pricing');
                    updatePlanPrices('CAD', 13.47, 36.44, 135);
                } else if (currency === 'INR') {
                    console.log('üáÆüá≥ Applying Indian pricing');
                    updatePlanPrices('INR', 499, 1497, 5988);
                } else {
                    // Use default USD pricing for other countries
                    console.log('üá∫üá∏ Using default USD pricing');
                    updatePlanPrices('USD', 9.99, 26.99, 99.99);
                }
            } catch (error) {
                console.error('‚ùå Error in updateSubscriptionPricingForUser:', error);
                // Fallback to USD
                updatePlanPrices('USD', 9.99, 26.99, 99.99);
            }
        }

        function updatePlanPrices(currency, monthly, quarterly, yearly) {
            // Update the main price display
            const monthlyPrice = document.querySelector('#monthlyPlan .plan-price');
            const quarterlyPrice = document.querySelector('#quarterlyPlan .plan-price');
            const yearlyPrice = document.querySelector('#yearlyPlan .plan-price');
            
            const symbol = currency === 'CAD' ? '$' : currency === 'INR' ? '‚Çπ' : '$';
            
            console.log('üí∞ Updating plan prices to:', currency, { monthly, quarterly, yearly });
            
            if (monthlyPrice) {
                monthlyPrice.innerHTML = `<span class="currency">${symbol}</span>${monthly}<span class="period">/month</span>`;
                console.log('‚úÖ Updated monthly price');
            } else {
                console.log('‚ö†Ô∏è Monthly price element not found');
            }
            
            if (quarterlyPrice) {
                quarterlyPrice.innerHTML = `<span class="currency">${symbol}</span>${quarterly}<span class="period">/3 months</span>`;
                console.log('‚úÖ Updated quarterly price');
            } else {
                console.log('‚ö†Ô∏è Quarterly price element not found');
            }
            
            if (yearlyPrice) {
                yearlyPrice.innerHTML = `<span class="currency">${symbol}</span>${yearly}<span class="period">/year</span>`;
                console.log('‚úÖ Updated yearly price');
            } else {
                console.log('‚ö†Ô∏è Yearly price element not found');
            }
        }

        function ensureUserHasCountryData() {
            const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || '{}');
            
            // If user exists but has no country data, prompt them
            if (currentUser.email && !currentUser.country) {
                console.log('‚ö†Ô∏è User missing country data, prompting for selection...');
                const userChoice = prompt(
                    'üåç Country Selection Required\n\nTo show you the correct pricing, please select your country:\n\n1 - Canada (CAD pricing)\n2 - India (INR pricing)\n3 - Other countries (USD pricing)\n\nEnter 1, 2, or 3:'
                );
                
                let country = 'Other';
                if (userChoice === '1') {
                    country = 'Canada';
                } else if (userChoice === '2') {
                    country = 'India';
                }
                
                // Update user data with country
                currentUser.country = country;
                localStorage.setItem('french_app_current_user', JSON.stringify(currentUser));
                
                console.log('‚úÖ Country updated to:', country);
                return country;
            }
            
            return currentUser.country || 'Other';
        }

        async function updatePaymentButtonCurrency() {
            console.log('üîç updatePaymentButtonCurrency called');
            
            try {
                // Get currency from Firebase first, then localStorage
                const userCurrency = await getUserCurrency();
                const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || '{}');
                const btnText = document.getElementById('subscribeBtnText');
                
                console.log('üë§ Current user data:', currentUser);
                console.log('üí∞ Detected currency:', userCurrency);
                
                if (btnText) {
                    let defaultText;
                    if (userCurrency === 'CAD') {
                        defaultText = 'Complete Payment $13.47 CAD/month';
                    } else if (userCurrency === 'INR') {
                        defaultText = 'Complete Payment ‚Çπ499 INR/month';
                    } else {
                        defaultText = 'Complete Payment $9.99 USD/month';
                    }
                    btnText.textContent = defaultText;
                    console.log('‚úÖ Button currency updated to:', defaultText);
                    console.log('‚úÖ Button element updated successfully');
                } else {
                    console.error('‚ùå subscribeBtnText element not found!');
                }
            } catch (error) {
                console.error('‚ùå Error in updatePaymentButtonCurrency:', error);
                // Fallback to USD if there's an error
                const btnText = document.getElementById('subscribeBtnText');
                if (btnText) {
                    btnText.textContent = 'Complete Payment $9.99 USD/month';
                }
            }
        }

        // Tech-Pay Centralized Payment System Configuration
        // Environment Configuration - UPDATE FOR LIVE INTEGRATION
        const STRIPE_CONFIG = {
            environment: 'live',  // 'test' or 'live' - LIVE ENVIRONMENT ACTIVATED
            test: {
                publishableKey: 'pk_test_TYooMQauvdEDq54NiTphI7jx',
            },
            live: {
                publishableKey: 'pk_live_51Rr5H03QiDHRr52effkP2HrTynAiO7NYD8VQfmbQiHTfpj3zvbw7q4p3uSeRWHHK0ehhHAoYqHyxXwIjmuyGVz3Q00BJL8lkM9',
            }
        };

        // Get current Stripe publishable key based on environment
        function getStripePublishableKey() {
            const config = STRIPE_CONFIG[STRIPE_CONFIG.environment];
            console.log(`üîß Using ${STRIPE_CONFIG.environment} Stripe environment`);
            return config.publishableKey;
        }

        // Global Stripe variables (from Tech-Pay.html)
        // selectedPlan is already declared elsewhere in the file
        let stripe = null;
        let elements = null;
        let cardElement = null;

        // Live Payment Helper Function
        function logPaymentSuccess(paymentIntent, planType, currency, amount) {
            console.log('üìä Payment Success Log:', {
                payment_id: paymentIntent?.id || 'demo_' + Date.now(),
                plan: planType,
                currency: currency,
                amount: amount,
                timestamp: new Date().toISOString(),
                environment: STRIPE_CONFIG.environment
            });

            // Store payment info in localStorage for tracking
            const paymentHistory = JSON.parse(localStorage.getItem('payment_history') || '[]');
            paymentHistory.push({
                id: paymentIntent?.id || 'demo_' + Date.now(),
                plan: planType,
                currency: currency,
                amount: amount,
                date: new Date().toISOString(),
                status: 'completed'
            });
            localStorage.setItem('payment_history', JSON.stringify(paymentHistory));
        }

        async function selectPlan(planType) {
            console.log('üéØ Plan selected:', planType);
            
            try {
                selectedPlan = planType;
                
                // Clear any existing error messages
                clearMessages();
                
                // Update UI - remove selected class from all cards
                document.querySelectorAll('.plan-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Add selected class to the chosen plan
                const selectedCard = document.getElementById(planType + 'Plan');
                if (selectedCard) {
                    selectedCard.classList.add('selected');
                    console.log('‚úÖ Plan card updated:', planType + 'Plan');
                } else {
                    console.error('‚ùå Could not find plan card:', planType + 'Plan');
                }
                
                // Show payment section with smooth transition
                const paymentSection = document.getElementById('paymentSection');
                if (paymentSection) {
                    paymentSection.style.display = 'block';
                    paymentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    console.log('‚úÖ Payment section shown');
                } else {
                    console.error('‚ùå Could not find payment section');
                }
                
                // Update button text with selected plan amount based on user's country
                const userCurrency = await getUserCurrency();
                let amount;
                
                if (userCurrency === 'CAD') {
                    if (planType === 'monthly') {
                        amount = '$13.47 CAD/month';
                    } else if (planType === 'quarterly') {
                        amount = '$36.44 CAD/3 months';
                    } else if (planType === 'yearly') {
                        amount = '$135 CAD/year';
                    }
                } else if (userCurrency === 'INR') {
                    if (planType === 'monthly') {
                        amount = '‚Çπ499 INR/month';
                    } else if (planType === 'quarterly') {
                        amount = '‚Çπ1,497 INR/3 months';
                    } else if (planType === 'yearly') {
                        amount = '‚Çπ5,988 INR/year';
                    }
                } else {
                    // Default USD pricing
                    if (planType === 'monthly') {
                        amount = '$9.99 USD/month';
                    } else if (planType === 'quarterly') {
                        amount = '$26.99 USD/3 months';
                    } else if (planType === 'yearly') {
                        amount = '$99.99 USD/year';
                    }
                }
                
                const btnText = document.getElementById('subscribeBtnText');
                if (btnText) {
                    btnText.textContent = `Complete Payment ${amount}`;
                    console.log('‚úÖ Button text updated:', amount);
                } else {
                    console.error('‚ùå Could not find subscribe button text');
                }
                
                // Initialize Stripe if not already done
                if (!stripe) {
                    console.log('üîÑ Initializing Stripe...');
                    initializeStripe();
                }
                
                // Show success message for plan selection
                const planName = planType === 'monthly' ? 'Monthly' : planType === 'quarterly' ? 'Quarterly' : 'Yearly';
                showSuccess('subscriptionSuccess', `${planName} Premium plan selected! Please fill in your payment details below.`);
                
                console.log('üéâ Plan selection completed successfully');
                
            } catch (error) {
                console.error('‚ùå Error in selectPlan:', error);
                showError('subscriptionError', 'There was an error selecting your plan. Please try again.');
            }
            
            // Scroll to payment section
            document.getElementById('paymentSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Tech-Pay Centralized Stripe Initialization (from Tech-Pay.html)
        function initializeStripe() {
            console.log('üîÑ Initializing Stripe...');
            
            if (typeof Stripe === 'undefined') {
                console.error('‚ùå Stripe.js not loaded');
                showError('subscriptionError', 'Payment system not available. Please refresh the page.');
                return;
            }

            try {
                // Initialize Stripe with environment-appropriate key (Tech-Pay System)
                const publishableKey = getStripePublishableKey();
                stripe = Stripe(publishableKey);
                elements = stripe.elements();
                
                // Create card element optimized for international users
                // Supports CAD, INR, USD, and other international cards
                cardElement = elements.create('card', {
                    style: {
                        base: {
                            fontSize: '16px',
                            color: '#424770',
                            '::placeholder': {
                                color: '#aab7c4',
                            },
                        },
                    },
                    hidePostalCode: true // International-friendly: Remove ZIP code requirement
                });
                
                cardElement.mount('#card-element');
                
                // Handle real-time validation errors from the card Element
                cardElement.on('change', ({error}) => {
                    const displayError = document.getElementById('card-errors');
                    if (error) {
                        displayError.textContent = error.message;
                    } else {
                        displayError.textContent = '';
                    }
                });
                
                console.log('‚úÖ Stripe initialized successfully with Tech-Pay system');
                
            } catch (error) {
                console.error('‚ùå Error initializing Stripe:', error);
                showError('subscriptionError', 'Payment system initialization failed. Please refresh the page.');
            }
        }

        // Tech-Pay Centralized Payment Processing (Live Bank Integration Ready)
        async function processPayment() {
            if (!selectedPlan) {
                showError('subscriptionError', 'Please select a subscription plan.');
                return;
            }
            
            const cardholderName = document.getElementById('cardholderName').value;
            if (!cardholderName.trim()) {
                showError('subscriptionError', 'Please enter the cardholder name.');
                return;
            }
            
            // Show loading
            const subscribeBtn = document.getElementById('subscribeBtn');
            const subscribeBtnText = document.getElementById('subscribeBtnText');
            const subscribeSpinner = document.getElementById('subscribeSpinner');
            
            subscribeBtnText.style.display = 'none';
            subscribeSpinner.style.display = 'inline';
            subscribeBtn.disabled = true;
            
            try {
                // Create payment method with Stripe
                const {error, paymentMethod} = await stripe.createPaymentMethod({
                    type: 'card',
                    card: cardElement,
                    billing_details: {
                        name: cardholderName,
                    },
                });
                
                if (error) {
                    throw new Error(error.message);
                }
                
                console.log('‚úÖ Payment method created:', paymentMethod.id);
                
                // Get pricing for the selected plan and currency
                const userCurrency = await getUserCurrency();
                let priceInCents;
                
                if (userCurrency === 'CAD') {
                    priceInCents = selectedPlan === 'monthly' ? 1347 : selectedPlan === 'quarterly' ? 3644 : 13500;
                } else if (userCurrency === 'INR') {
                    priceInCents = selectedPlan === 'monthly' ? 49900 : selectedPlan === 'quarterly' ? 149700 : 598800; // INR uses paisa (1/100)
                } else {
                    priceInCents = selectedPlan === 'monthly' ? 999 : selectedPlan === 'quarterly' ? 2699 : 9999;
                }
                
                console.log('üí≥ Processing payment for:', priceInCents, userCurrency);
                
                // LIVE ENVIRONMENT: Backend Payment Processing with Stripe Payment Intents
                if (STRIPE_CONFIG.environment === 'live') {
                    console.log('üöÄ Processing LIVE payment with backend integration');
                    
                    try {
                        console.log('üí≥ Creating payment intent with backend...');
                        
                        // Get current user for customer details
                        const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || '{}');
                        
                        // Create payment intent via backend
                        const response = await fetch('https://foundation-backend-chi.vercel.app/create-payment-intent', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                planType: selectedPlan,
                                currency: userCurrency,
                                amount: priceInCents,
                                customerEmail: currentUser.email || '',
                                customerName: currentUser.displayName || cardholderName
                            })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Payment setup failed');
                        }
                        
                        const { clientSecret, paymentIntentId } = await response.json();
                        console.log('‚úÖ Payment intent created:', paymentIntentId);
                        
                        // Confirm payment with Stripe
                        const { error: confirmError, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
                            payment_method: paymentMethod.id
                        });
                        
                        if (confirmError) {
                            throw new Error(confirmError.message);
                        }
                        
                        if (paymentIntent.status === 'succeeded') {
                            console.log('‚úÖ LIVE payment processed successfully!');
                            console.log('üí∞ Payment Details:', paymentIntent);
                            
                            // Log the successful payment for tracking
                            logPaymentSuccess(paymentIntent, selectedPlan, userCurrency, priceInCents);
                        } else {
                            throw new Error('Payment was not completed successfully');
                        }
                        
                    } catch (liveError) {
                        console.error('‚ùå Live payment processing error:', liveError);
                        
                        // Redirect to error page with details
                        const errorParams = new URLSearchParams({
                            error: liveError.message || 'Payment processing failed',
                            code: liveError.code || 'PAYMENT_FAILED',
                            plan: selectedPlan,
                            amount: priceInCents,
                            currency: userCurrency
                        });
                        
                        window.location.href = 'payment-error.html?' + errorParams.toString();
                        return;
                    }
                } else {
                    // Test environment processing
                    console.log('‚úÖ Payment processed successfully with Stripe using test card');
                }
                
                // Update user subscription in Firebase
                console.log('üí≥ Payment successful, updating Firebase...');
                const updateResult = await updateUserSubscription(selectedPlan);
                
                if (!updateResult || !updateResult.success) {
                    console.error('‚ùå Subscription update failed:', updateResult);
                    const errorMsg = updateResult?.error || 'Unknown Firebase error';
                    throw new Error(`Failed to update subscription in Firebase: ${errorMsg}`);
                }
                
                console.log('‚úÖ Firebase updated successfully, updating localStorage...');
                
                // Update localStorage with the actual Firebase data
                const currentUser = JSON.parse(localStorage.getItem('french_app_current_user'));
                currentUser.subscription = {
                    status: 'premium',
                    plan: selectedPlan,
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + (selectedPlan === 'monthly' ? 30 : selectedPlan === 'quarterly' ? 90 : 365) * 24 * 60 * 60 * 1000).toISOString(),
                    active: true,
                    paymentMethod: 'stripe'
                };
                localStorage.setItem('french_app_current_user', JSON.stringify(currentUser));
                
                console.log('‚úÖ localStorage updated with premium status');
                
                showSuccess('subscriptionSuccess', 'üéâ Payment successful! Welcome to Premium!');
                
                setTimeout(() => {
                    closeModal('subscriptionModal');
                    
                    // Update UI to show premium status
                    if (typeof updateSubscriptionUI === 'function') {
                        updateSubscriptionUI('premium');
                    }
                    
                    // Force refresh the menu access
                    if (typeof updateMenuAccess === 'function') {
                        updateMenuAccess();
                    }
                    
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Payment processing error:', error);
                showError('subscriptionError', error.message);
                
            } finally {
                // Reset button state
                subscribeBtnText.style.display = 'inline';
                subscribeSpinner.style.display = 'none';
                subscribeBtn.disabled = false;
            }
        }

        async function updateUserSubscription(plan) {
            const firebaseUser = firebase.auth().currentUser;
            if (!firebaseUser) {
                console.log('‚ùå No Firebase user for subscription update');
                return { success: false, error: 'No authenticated user' };
            }
            
            try {
                console.log('üîç Starting Firebase subscription update...');
                console.log('üÜî Plan parameter:', plan);
                console.log('üÜî FirebaseUser UID:', firebaseUser.uid);
                
                const userDocRef = firebase.firestore().collection('users').doc(firebaseUser.uid);
                
                const subscriptionData = {
                    status: 'premium',
                    plan: plan,
                    startDate: new Date(),
                    endDate: new Date(Date.now() + (plan === 'monthly' ? 30 : plan === 'quarterly' ? 90 : 365) * 24 * 60 * 60 * 1000),
                    paymentMethod: 'stripe',
                    active: true,
                    updatedAt: new Date()
                };
                
                console.log('üìù Attempting to update subscription data:', subscriptionData);
                
                try {
                    // Try to update existing document first
                    await userDocRef.update({
                        subscription: subscriptionData
                    });
                    console.log('‚úÖ Updated existing user document');
                } catch (updateError) {
                    console.log('‚ö†Ô∏è Update failed, attempting set instead:', updateError.message);
                    // If update fails (document doesn't exist), create it
                    await userDocRef.set({
                        email: firebaseUser.email,
                        name: firebaseUser.displayName || firebaseUser.email,
                        subscription: subscriptionData,
                        createdAt: new Date()
                    });
                    console.log('‚úÖ Created new user document');
                }
                
                console.log('‚úÖ Firebase subscription update completed successfully');
                return { success: true };
                
            } catch (error) {
                console.error('‚ùå Firebase subscription update failed:', error);
                return { success: false, error: error.message };
            }
        }

        function updateSubscriptionUI(status) {
            const subscriptionStatusSpan = document.getElementById('subscriptionStatus');
            const subscriptionBtn = document.getElementById('subscriptionBtn');
            
            if (status === 'premium') {
                if (subscriptionStatusSpan) {
                    subscriptionStatusSpan.textContent = 'Premium';
                    subscriptionStatusSpan.className = 'subscription-status premium';
                }
                // Hide the subscription button for premium users to keep it clean
                if (subscriptionBtn) subscriptionBtn.style.display = 'none';
            } else {
                if (subscriptionStatusSpan) {
                    subscriptionStatusSpan.textContent = 'Free';
                    subscriptionStatusSpan.className = 'subscription-status free';
                }
                if (subscriptionBtn) {
                    subscriptionBtn.innerHTML = 'üíé Go Premium';
                    subscriptionBtn.className = 'subscription-btn';
                    subscriptionBtn.style.display = 'inline-flex';
                    subscriptionBtn.onclick = openSubscriptionModal;
                }
            }
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        // localStorage-based authentication (demo mode)
        function handleSignUp(event) {
            event.preventDefault();
            
            const email = document.getElementById('signUpEmail').value;
            const password = document.getElementById('signUpPassword').value;
            const name = document.getElementById('signUpName').value;
            const country = document.getElementById('signUpCountry').value;
            
            // Show loading
            document.getElementById('signUpBtnText').style.display = 'none';
            document.getElementById('signUpSpinner').style.display = 'inline';
            document.getElementById('signUpBtn').disabled = true;
            
            // Simulate API delay
            setTimeout(() => {
                // Get existing users
                const users = JSON.parse(localStorage.getItem('french_app_users') || '[]');
                
                // Check if user already exists
                if (users.find(user => user.email === email)) {
                    showError('signUpError', 'An account with this email already exists.');
                } else {
                    // Add new user
                    const newUser = {
                        email: email,
                        name: name,
                        country: country,
                        registeredAt: new Date().toISOString(),
                        subscription: {
                            status: 'free',
                            plan: null,
                            startDate: null,
                            endDate: null
                        }
                    };
                    users.push(newUser);
                    localStorage.setItem('french_app_users', JSON.stringify(users));
                    
                    // Set current user
                    localStorage.setItem('french_app_current_user', JSON.stringify(newUser));
                    
                    showSuccess('signUpSuccess', 'Account created successfully! Welcome!');
                    
                    setTimeout(() => {
                        closeModal('signUpModal');
                        toggleAuthButtons(true, name, 'free');
                    }, 1500);
                }
                
                // Hide loading
                document.getElementById('signUpBtnText').style.display = 'inline';
                document.getElementById('signUpSpinner').style.display = 'none';
                document.getElementById('signUpBtn').disabled = false;
            }, 1000);
        }

        function handleSignIn(event) {
            event.preventDefault();
            
            // Clear any existing error messages first
            clearMessages();
            
            const email = document.getElementById('signInEmail').value;
            const password = document.getElementById('signInPassword').value;
            
            // Show loading
            document.getElementById('signInBtnText').style.display = 'none';
            document.getElementById('signInSpinner').style.display = 'inline';
            document.getElementById('signInBtn').disabled = true;
            
            // Simulate API delay
            setTimeout(async () => {
                try {
                    // First try Firebase authentication if available
                    if (typeof firebase !== 'undefined' && firebase.auth) {
                        console.log('üî• Attempting Firebase authentication for:', email);
                        
                        try {
                            const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                            const user = userCredential.user;
                            console.log('‚úÖ Firebase authentication successful:', user.email);
                            
                            // Get user data from Firestore or use defaults
                            let userData = {
                                email: user.email,
                                name: user.displayName || user.email.split('@')[0],
                                uid: user.uid,
                                subscription: { status: 'free' }
                            };
                            
                            try {
                                if (typeof firebase.firestore !== 'undefined') {
                                    const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                                    if (userDoc.exists) {
                                        userData = { ...userData, ...userDoc.data() };
                                        console.log('‚úÖ Firestore user data retrieved');
                                    }
                                }
                            } catch (firestoreError) {
                                console.log('‚ö†Ô∏è Firestore operation failed, using defaults');
                            }
                            
                            // Store in localStorage for compatibility
                            localStorage.setItem('french_app_current_user', JSON.stringify(userData));
                            
                            showSuccess('signInSuccess', 'Successfully signed in! Welcome back!');
                            
                            setTimeout(() => {
                                closeModal('signInModal');
                                toggleAuthButtons(true, userData.name, userData.subscription?.status || 'free');
                                // Update subscription pricing silently if function exists
                                if (typeof updateSubscriptionPricingForUser === 'function') {
                                    try {
                                        updateSubscriptionPricingForUser();
                                    } catch (pricingError) {
                                        console.log('‚ö†Ô∏è Pricing update failed silently, using defaults');
                                    }
                                }
                            }, 1500);
                            
                            // Additional safeguard: Clear any error messages that might appear after success
                            setTimeout(() => {
                                const errorElements = document.querySelectorAll('.error-message');
                                errorElements.forEach(el => {
                                    el.style.display = 'none';
                                    el.textContent = '';
                                });
                            }, 2500);
                            
                            return; // Success, exit function
                            
                        } catch (firebaseError) {
                            console.log('‚ö†Ô∏è Firebase authentication failed:', firebaseError.message);
                            // Fall back to localStorage check for backward compatibility
                        }
                    }
                    
                    // Fallback: Check localStorage for existing users (backward compatibility)
                    console.log('üîÑ Falling back to localStorage authentication');
                    const users = JSON.parse(localStorage.getItem('french_app_users') || '[]');
                    const user = users.find(u => u.email === email);
                    
                    if (user) {
                        // Set current user
                        localStorage.setItem('french_app_current_user', JSON.stringify(user));
                        
                        showSuccess('signInSuccess', 'Successfully signed in! Welcome back!');
                        
                        setTimeout(() => {
                            closeModal('signInModal');
                            toggleAuthButtons(true, user.name, user.subscription?.status || 'free');
                            // Update subscription pricing silently if function exists
                            if (typeof updateSubscriptionPricingForUser === 'function') {
                                try {
                                    updateSubscriptionPricingForUser();
                                } catch (pricingError) {
                                    console.log('‚ö†Ô∏è Pricing update failed silently, using defaults');
                                }
                            }
                        }, 1500);
                        
                        // Additional safeguard: Clear any error messages that might appear after success
                        setTimeout(() => {
                            const errorElements = document.querySelectorAll('.error-message');
                            errorElements.forEach(el => {
                                el.style.display = 'none';
                                el.textContent = '';
                            });
                        }, 2500);
                        
                    } else {
                        showError('signInError', 'Invalid email or password. Please try again.');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Authentication error:', error);
                    showError('signInError', 'Sign in failed. Please try again.');
                }
                
                // Hide loading
                document.getElementById('signInBtnText').style.display = 'inline';
                document.getElementById('signInSpinner').style.display = 'none';
                document.getElementById('signInBtn').disabled = false;
            }, 1000);
        }

        function signOut() {
            console.log('üö™ COMPLETE SIGN OUT from French-Alphabets.html');
            
            // STEP 1: Set Firebase persistence to NONE to prevent auto-restore
            console.log('üî• Step 1: Disabling Firebase persistence...');
            if (typeof firebase !== 'undefined' && firebase.auth) {
                firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE).then(() => {
                    console.log('‚úÖ Firebase persistence disabled');
                    return firebase.auth().signOut();
                }).then(() => {
                    console.log('‚úÖ Firebase sign out successful - now clearing storage...');
                    completeSignOutCleanup();
                }).catch((error) => {
                    console.log('‚ùå Firebase operations error, proceeding with fallback cleanup:', error);
                    // Force sign out even if persistence change fails
                    firebase.auth().signOut().catch(() => {});
                    completeSignOutCleanup();
                });
            } else {
                console.log('üî• No Firebase available, proceeding with local cleanup...');
                completeSignOutCleanup();
            }
        }

        // Helper function to complete sign-out cleanup after Firebase sign-out
        function completeSignOutCleanup() {
            console.log('üßπ Step 2: Clearing all storage after Firebase sign-out...');
            
            // Clear storage
            localStorage.clear();
            sessionStorage.clear();
            
            console.log('üßπ Step 3: UI reset...');
            try {
                performCompleteUIReset();
            } catch (error) {
                console.log('UI reset error (ignored):', error);
            }
            
            console.log('üßπ Step 4: Setting sign-out flags...');
            // Set flags for index.html detection
            sessionStorage.setItem('just_signed_out', 'true');
            sessionStorage.setItem('force_guest_state', 'true');
            sessionStorage.setItem('firebase_signed_out', 'true');
            
            // Show feedback
            alert('‚úÖ SUCCESSFULLY SIGNED OUT! Redirecting to home page...');
            
            console.log('üö™ Step 5: Redirecting to home page...');
            // Redirect after short delay
            setTimeout(() => {
                console.log('üöÄ Redirecting with sign-out confirmation...');
                window.location.replace('index.html?signedOut=true&firebaseSignedOut=true');
            }, 300);
        }

        // Helper function to perform complete UI reset
        function performCompleteUIReset() {
            console.log('üîÑ Performing complete UI reset from French-Alphabets.html...');
            
            try {
                // Clear all user data from localStorage
                localStorage.removeItem('french_app_current_user');
                localStorage.removeItem('french_app_users'); // Clear all users for fresh start
                
                // Reset authentication UI
                toggleAuthButtons(false);
                
                // Force reset subscription UI to default state
                resetSubscriptionUIToDefault();
                
                // Force reset menu access to default (free) state
                updateMenuAccess();
                
                console.log('‚úÖ UI reset completed');
                
            } catch (error) {
                console.error('‚ùå Error during UI reset:', error);
            }
        }

        // Helper function to complete the sign out process
        function completeSignOutProcess() {
            console.log('üèÅ Completing sign out process...');
            
            // Show success message
            alert('Successfully signed out! Redirecting to home page...');
            
            // Set flag to help index.html detect sign-out redirect
            sessionStorage.setItem('just_signed_out', 'true');
            
            // Redirect to home page after a short delay
            setTimeout(() => {
                window.location.href = 'index.html?signedOut=true';
            }, 1000);
            
            console.log('‚úÖ Sign out process completed');
        }

        // Function to reset subscription UI to default free state
        function resetSubscriptionUIToDefault() {
            console.log('üîÑ Resetting subscription UI to default state...');
            
            try {
                const subscriptionStatusSpan = document.getElementById('subscriptionStatus');
                const subscriptionBtn = document.getElementById('subscriptionBtn');
                const userNameSpan = document.getElementById('userName');
                
                // Reset subscription status
                if (subscriptionStatusSpan) {
                    subscriptionStatusSpan.textContent = 'Free';
                    subscriptionStatusSpan.className = 'subscription-status free';
                }
                
                // Reset subscription button
                if (subscriptionBtn) {
                    subscriptionBtn.innerHTML = 'üíé Go Premium';
                    subscriptionBtn.className = 'subscription-btn';
                    subscriptionBtn.onclick = () => { window.location.href = 'index.html'; };
                }
                
                // Reset user name
                if (userNameSpan) {
                    userNameSpan.textContent = 'Welcome!';
                }
                
                console.log('‚úÖ Subscription UI reset to default');
                
            } catch (error) {
                console.error('‚ùå Error resetting subscription UI:', error);
            }
                  }

          // Function to check and update authentication status on page load
          function checkAuthStatus() {
              const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || 'null');
              
              if (currentUser) {
                  console.log('‚úÖ User found on page load:', currentUser.name);
                  toggleAuthButtons(true, currentUser.name, currentUser.subscription?.status || 'free');
              } else {
                  console.log('‚ùå No user found - showing guest state');
                  toggleAuthButtons(false);
              }
          }

          // Initialize form event listeners when DOM is ready
          document.addEventListener('DOMContentLoaded', function() {
              const signUpForm = document.getElementById('signUpForm');
              const signInForm = document.getElementById('signInForm');
              
              if (signUpForm) {
                  signUpForm.addEventListener('submit', handleSignUp);
              }
              
              if (signInForm) {
                  signInForm.addEventListener('submit', handleSignIn);
              }
              
              // Check authentication status on page load
              checkAuthStatus();
          });

          // Global variables for subscription
        let selectedPlan = null;

        function clearMessages() {
            document.querySelectorAll('.error-message, .success-message').forEach(msg => {
                msg.style.display = 'none';
                msg.textContent = '';
            });
        }

        // Subscription Functions
        async function selectPlan(planType) {
            console.log('üéØ Plan selected:', planType);
            
            try {
                selectedPlan = planType;
                
                // Clear any existing error messages
                clearMessages();
                
                // Update UI - remove selected class from all cards
                document.querySelectorAll('.plan-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Add selected class to the chosen plan
                const selectedCard = document.getElementById(planType + 'Plan');
                if (selectedCard) {
                    selectedCard.classList.add('selected');
                    console.log('‚úÖ Plan card updated:', planType + 'Plan');
                } else {
                    console.error('‚ùå Could not find plan card:', planType + 'Plan');
                }
                
                // Show payment section with smooth transition
                const paymentSection = document.getElementById('paymentSection');
                if (paymentSection) {
                    paymentSection.style.display = 'block';
                    paymentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    console.log('‚úÖ Payment section shown');
                } else {
                    console.error('‚ùå Could not find payment section');
                }
                
                // Update button text with selected plan amount (Firebase-aware)
                const userCurrency = await getUserCurrency();
                let amount;
                
                if (userCurrency === 'CAD') {
                    if (planType === 'monthly') {
                        amount = '$13.47 CAD/month';
                    } else if (planType === 'quarterly') {
                        amount = '$36.44 CAD/3 months';
                    } else if (planType === 'yearly') {
                        amount = '$135 CAD/year';
                    }
                } else if (userCurrency === 'INR') {
                    if (planType === 'monthly') {
                        amount = '‚Çπ499 INR/month';
                    } else if (planType === 'quarterly') {
                        amount = '‚Çπ1,497 INR/3 months';
                    } else if (planType === 'yearly') {
                        amount = '‚Çπ5,988 INR/year';
                    }
                } else {
                    // Default USD pricing
                    if (planType === 'monthly') {
                        amount = '$9.99 USD/month';
                    } else if (planType === 'quarterly') {
                        amount = '$26.99 USD/3 months';
                    } else if (planType === 'yearly') {
                        amount = '$99.99 USD/year';
                    }
                }
                
                const btnText = document.getElementById('subscribeBtnText');
                if (btnText) {
                    btnText.textContent = `Complete Payment ${amount}`;
                    console.log('‚úÖ Button text updated:', amount);
                } else {
                    console.error('‚ùå Could not find subscribe button text');
                }
                
                // Show success message for plan selection
                const planName = planType === 'monthly' ? 'Monthly' : planType === 'quarterly' ? 'Quarterly' : 'Yearly';
                showSuccess('subscriptionSuccess', `${planName} Premium plan selected! Please fill in your payment details below.`);
                
                console.log('üéâ Plan selection completed successfully');
                
            } catch (error) {
                console.error('‚ùå Error in selectPlan:', error);
                showError('subscriptionError', 'There was an error selecting your plan. Please try again.');
            }
        }

        // Global Firebase error handler to prevent error flashing
        window.addEventListener('unhandledrejection', function(event) {
            if (event.reason && event.reason.message && 
                (event.reason.message.includes('Firebase') || 
                 event.reason.message.includes('auth/') ||
                 event.reason.message.includes('firestore'))) {
                console.warn('üõ°Ô∏è Caught unhandled Firebase error:', event.reason.message);
                event.preventDefault(); // Prevent the error from showing to user
            }
        });

    </script>

    <!-- Sign Up Modal -->
    <div id="signUpModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signUpModal')">&times;</span>
            <h2>Create Account</h2>
            <div id="signUpError" class="error-message"></div>
            <div id="signUpSuccess" class="success-message"></div>
            <form id="signUpForm">
                <div class="form-group">
                    <label for="signUpEmail">Email Address</label>
                    <input type="email" id="signUpEmail" name="email" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signUpPassword">Password</label>
                    <input type="password" id="signUpPassword" name="password" required placeholder="Enter your password">
                </div>
                <div class="form-group">
                    <label for="signUpName">Full Name</label>
                    <input type="text" id="signUpName" name="name" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="signUpCountry">Country</label>
                    <select id="signUpCountry" name="country" required>
                        <option value="">Select your country</option>
                        <option value="Canada">üá®üá¶ Canada</option>
                        <option value="India">üáÆüá≥ India</option>
                        <option value="United States">üá∫üá∏ United States</option>
                        <option value="United Kingdom">üá¨üáß United Kingdom</option>
                        <option value="Germany">üá©üá™ Germany</option>
                        <option value="France">üá´üá∑ France</option>
                        <option value="Japan">üáØüáµ Japan</option>
                        <option value="Australia">üá¶üá∫ Australia</option>
                        <option value="Other">üåê Other</option>
                    </select>
                </div>
                <button type="submit" class="auth-btn" id="signUpBtn">
                    <span id="signUpBtnText">Create Account</span>
                    <span id="signUpSpinner" class="spinner"></span>
                </button>
            </form>
            <div class="switch-auth">
                Already have an account? <a href="#" onclick="switchToSignIn()">Sign In</a>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div id="signInModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signInModal')">&times;</span>
            <h2>Welcome Back</h2>
            <div id="signInError" class="error-message"></div>
            <div id="signInSuccess" class="success-message"></div>
            <form id="signInForm">
                <div class="form-group">
                    <label for="signInEmail">Email Address</label>
                    <input type="email" id="signInEmail" name="email" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signInPassword">Password</label>
                    <input type="password" id="signInPassword" name="password" required placeholder="Enter your password">
                </div>
                <button type="submit" class="auth-btn" id="signInBtn">
                    <span id="signInBtnText">Sign In</span>
                    <span id="signInSpinner" class="spinner"></span>
                </button>
            </form>
            <div class="switch-auth">
                Don't have an account? <a href="#" onclick="switchToSignUp()">Sign Up</a>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscriptionModal" class="modal">
        <div class="modal-content subscription-modal-content">
            <span class="close" onclick="closeModal('subscriptionModal')">&times;</span>
            <h2>üåü Upgrade to Premium</h2>
            <div id="subscriptionError" class="error-message"></div>
            <div id="subscriptionSuccess" class="success-message"></div>
            
            <div class="subscription-plans">
                <div class="plan-card" onclick="selectPlan('monthly')" id="monthlyPlan">
                    <div class="plan-name">Monthly Premium</div>
                    <div class="plan-price">
                        <span class="currency">$</span>9.99<span class="period">/month</span>
                    </div>
                    <ul class="plan-features">
                        <li>Unlimited access to all modules</li>
                        <li>Advanced pronunciation guides</li>
                        <li>Interactive exercises</li>
                        <li>Progress tracking</li>
                        <li>Downloadable content</li>
                        <li>Priority support</li>
                    </ul>
                </div>
                
                <div class="plan-card popular" onclick="selectPlan('quarterly')" id="quarterlyPlan">
                    <div class="plan-name">Quarterly Premium</div>
                    <div class="plan-price">
                        <span class="currency">$</span>26.99<span class="period">/3 months</span>
                    </div>
                    <div style="background: #3498db; color: white; padding: 0.3rem; border-radius: 15px; margin: 0.5rem 0; font-weight: 600; font-size: 0.7rem;">
                        Save $3.98 (10% off)
                    </div>
                    <ul class="plan-features">
                        <li>Everything in Monthly Premium</li>
                        <li>10% discount vs monthly</li>
                        <li>Quarterly progress reports</li>
                        <li>Flexible learning schedule</li>
                        <li>Mid-term assessments</li>
                        <li>Enhanced support</li>
                    </ul>
                </div>
                
                <div class="plan-card premium" onclick="selectPlan('yearly')" id="yearlyPlan">
                    <div class="plan-name">Yearly Premium</div>
                    <div class="plan-price">
                        <span class="currency">$</span>99.99<span class="period">/year</span>
                    </div>
                    <div style="background: #ff8c00; color: white; padding: 0.5rem; border-radius: 20px; margin: 1rem 0; font-weight: 600;">
                        Save $19.89 (17% off)
                    </div>
                    <ul class="plan-features">
                        <li>Everything in Monthly Premium</li>
                        <li>2 months free (14 months total)</li>
                        <li>Advanced AI tutoring</li>
                        <li>Custom learning paths</li>
                        <li>Offline mode</li>
                        <li>Certificate of completion</li>
                    </ul>
                </div>
            </div>

            <div class="payment-section" id="paymentSection" style="display: none;">
                <h3>üí≥ Payment Information</h3>
                <div class="payment-form">
                    <div class="form-group">
                        <label for="cardholderName">Cardholder Name</label>
                        <input type="text" id="cardholderName" name="cardholderName" required placeholder="Enter cardholder name">
                    </div>
                    
                    <div class="form-group">
                        <label for="card-element">Credit or Debit Card</label>
                        <div id="card-element">
                            <!-- Stripe Elements will create form elements here -->
                        </div>
                        <div id="card-errors" role="alert" style="color: #721c24; margin-top: 0.5rem;"></div>
                    </div>

                    <button type="button" class="subscription-btn-modal" id="subscribeBtn" onclick="processPayment()">
                        <span id="subscribeBtnText">Complete Payment & Subscribe</span>
                        <span id="subscribeSpinner" class="spinner"></span>
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin-top: 1rem; color: #666; font-size: 0.85rem;">
                <p style="margin: 0.25rem 0;">üîí Secure payment processing by Stripe</p>
                <p style="margin: 0.25rem 0;">Cancel anytime ‚Ä¢ 30-day money-back guarantee</p>
            </div>

        </div>
    </div>

    <!-- Firebase SDK (v9 compat - standardized) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Stripe.js (Tech-Pay Centralized Payment System) -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Firebase Configuration (embedded from firebase-config.js) -->
    <script>
// Firebase Configuration (v8 compat syntax for HTML)
// ‚úÖ Your real Firebase project config
const firebaseConfig = {
  apiKey: "AIzaSyA12z5FR90bSz1x5Q3ay-uJxV8xNOS_xjk",
  authDomain: "french-learning-app-46d95.firebaseapp.com",
  projectId: "french-learning-app-46d95",
  storageBucket: "french-learning-app-46d95.firebasestorage.app",
  messagingSenderId: "270430812441",
  appId: "1:270430812441:web:3fa199a9131794e90c2d88",
  measurementId: "G-GHZV5LJH4P"
};

// Initialize Firebase (v8 compat syntax)
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Authentication Functions for Firebase
function firebaseSignUp(email, password, name, country) {
    return auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            
            // Update user profile with name
            return user.updateProfile({
                displayName: name
            }).then(() => {
                // Store additional user data in Firestore with subscription info
                return db.collection('users').doc(user.uid).set({
                    email: email,
                    name: name,
                    country: country,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    subscription: {
                        status: 'free',
                        plan: null,
                        startDate: null,
                        endDate: null,
                        active: false,
                        paymentMethod: null
                    },
                    subscriptionHistory: []
                });
            }).then(() => {
                return user;
            });
        });
}

function firebaseSignIn(email, password) {
    return auth.signInWithEmailAndPassword(email, password);
}

function firebaseSignOut() {
    return auth.signOut();
}

// Enhanced Authentication Functions (replace localStorage functions)
function handleFirebaseSignUp(event) {
    event.preventDefault();
    
    const email = document.getElementById('signUpEmail').value;
    const password = document.getElementById('signUpPassword').value;
    const name = document.getElementById('signUpName').value;
    const country = document.getElementById('signUpCountry').value;
    
    // Show loading
    document.getElementById('signUpBtnText').style.display = 'none';
    document.getElementById('signUpSpinner').style.display = 'inline';
    document.getElementById('signUpBtn').disabled = true;
    
    firebaseSignUp(email, password, name, country)
        .then((user) => {
            // Store user data in localStorage for compatibility
            const userData = {
                email: user.email,
                name: user.displayName || name,
                country: country,
                registeredAt: new Date().toISOString(),
                subscription: {
                    status: 'free',
                    plan: null,
                    startDate: null,
                    endDate: null
                }
            };
            localStorage.setItem('french_app_current_user', JSON.stringify(userData));
            
            showSuccess('signUpSuccess', 'Account created successfully! Welcome!');
            
            setTimeout(() => {
                closeModal('signUpModal');
                toggleAuthButtons(true, user.displayName, 'free');
                // Update subscription pricing based on user's country
                if (typeof updateSubscriptionPricingForUser === 'function') {
                    updateSubscriptionPricingForUser();
                }
            }, 1500);
        })
        .catch((error) => {
            let errorMessage = 'An error occurred. Please try again.';
            
            switch(error.code) {
                case 'auth/email-already-in-use':
                    errorMessage = 'An account with this email already exists.';
                    break;
                case 'auth/weak-password':
                    errorMessage = 'Password is too weak. Please use at least 6 characters.';
                    break;
                case 'auth/invalid-email':
                    errorMessage = 'Please enter a valid email address.';
                    break;
            }
            
            showError('signUpError', errorMessage);
        })
        .finally(() => {
            // Hide loading
            document.getElementById('signUpBtnText').style.display = 'inline';
            document.getElementById('signUpSpinner').style.display = 'none';
            document.getElementById('signUpBtn').disabled = false;
        });
}

function handleFirebaseSignIn(event) {
    event.preventDefault();
    
    const email = document.getElementById('signInEmail').value;
    const password = document.getElementById('signInPassword').value;
    
    // Show loading
    document.getElementById('signInBtnText').style.display = 'none';
    document.getElementById('signInSpinner').style.display = 'inline';
    document.getElementById('signInBtn').disabled = true;
    
    firebaseSignIn(email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            
            // Get user subscription status from Firestore
            return db.collection('users').doc(user.uid).get().then(async (doc) => {
                // Use the centralized subscription status function for consistency
                const subscriptionStatus = await getUserSubscriptionStatus(user.uid);
                
                let userData = {
                    email: user.email,
                    name: user.displayName || user.email,
                    country: null,
                    registeredAt: new Date().toISOString(),
                    subscription: {
                        status: subscriptionStatus,
                        plan: null,
                        startDate: null,
                        endDate: null
                    }
                };
                
                if (doc.exists) {
                    const firestoreData = doc.data();
                    userData.subscription = {
                        status: subscriptionStatus,
                        plan: firestoreData.subscription?.plan || null,
                        startDate: firestoreData.subscription?.startDate || null,
                        endDate: firestoreData.subscription?.endDate || null,
                        active: firestoreData.subscription?.active || false,
                        paymentMethod: firestoreData.subscription?.paymentMethod || null
                    };
                    userData.name = firestoreData.name || userData.name;
                    userData.country = firestoreData.country || null;
                    userData.registeredAt = firestoreData.createdAt ? firestoreData.createdAt.toDate().toISOString() : userData.registeredAt;
                }
                
                // Store user data in localStorage for compatibility
                localStorage.setItem('french_app_current_user', JSON.stringify(userData));
                
                showSuccess('signInSuccess', 'Successfully signed in! Welcome back!');
                
                setTimeout(() => {
                    closeModal('signInModal');
                    toggleAuthButtons(true, user.displayName || user.email, subscriptionStatus);
                    // Update subscription pricing based on user's country from Firebase
                    if (typeof updateSubscriptionPricingForUser === 'function') {
                        updateSubscriptionPricingForUser();
                    }
                }, 1500);
            });
        })
        .catch((error) => {
            let errorMessage = 'An error occurred. Please try again.';
            
            switch(error.code) {
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                    errorMessage = 'Invalid email or password. Please try again.';
                    break;
                case 'auth/invalid-email':
                    errorMessage = 'Please enter a valid email address.';
                    break;
                case 'auth/too-many-requests':
                    errorMessage = 'Too many failed attempts. Please try again later.';
                    break;
            }
            
            showError('signInError', errorMessage);
        })
        .finally(() => {
            // Hide loading
            document.getElementById('signInBtnText').style.display = 'inline';
            document.getElementById('signInSpinner').style.display = 'none';
            document.getElementById('signInBtn').disabled = false;
        });
}

function handleFirebaseSignOut() {
    firebaseSignOut()
        .then(() => {
            toggleAuthButtons(false);
            showSuccess('signInSuccess', 'Successfully signed out!');
            setTimeout(() => {
                clearMessages();
            }, 2000);
        })
        .catch((error) => {
            console.error('Sign out error:', error);
        });
}

async function getUserSubscriptionStatus(userId) {
    try {
        const doc = await db.collection('users').doc(userId).get();
        
        if (doc.exists) {
            const userData = doc.data();
            const subscription = userData.subscription || { status: 'free' };
            
            // Check if subscription is expired
            if (subscription.status === 'premium' && subscription.endDate) {
                const endDate = subscription.endDate.toDate ? subscription.endDate.toDate() : new Date(subscription.endDate);
                if (endDate < new Date()) {
                    // Update status to expired
                    await db.collection('users').doc(userId).update({
                        'subscription.status': 'expired',
                        'subscription.active': false
                    });
                    return 'expired';
                }
            }
            
            return subscription.status || 'free';
        }
        
        return 'free';
    } catch (error) {
        console.error('Error getting subscription status:', error);
        return 'free';
    }
}

// Listen for authentication state changes
auth.onAuthStateChanged(async (user) => {
    // Check for sign-out flags before doing anything
    const urlParams = new URLSearchParams(window.location.search);
    const sessionFlags = {
        signedOut: urlParams.get('signedOut') === 'true' || urlParams.get('firebaseSignedOut') === 'true',
        forceGuest: urlParams.get('forceGuest') === 'true',
        justSignedOut: sessionStorage.getItem('just_signed_out') === 'true',
        firebaseSignedOut: sessionStorage.getItem('firebase_signed_out') === 'true',
        forceGuestState: sessionStorage.getItem('force_guest_state') === 'true'
    };

    const isSignOutProcess = Object.values(sessionFlags).some(flag => flag) || window.FORCE_GUEST_MODE;

    if (isSignOutProcess) {
        // If there's still a Firebase user during sign-out process, sign them out
        if (user) {
            auth.signOut().catch(error => {
                console.log('Firebase sign-out error in onAuthStateChanged (ignored):', error);
            });
        }
        
        // Ensure localStorage is cleared and UI is in guest state
        localStorage.removeItem('french_app_current_user');
        if (typeof toggleAuthButtons === 'function') {
            toggleAuthButtons(false);
        }
        return;
    }

    if (user) {
        // User is signed in - get their subscription status and sync localStorage
        try {
            const subscriptionStatus = await getUserSubscriptionStatus(user.uid);
            
            // Ensure localStorage is synced with Firebase user data
            const doc = await db.collection('users').doc(user.uid).get();
            let userData = {
                email: user.email,
                name: user.displayName || user.email,
                country: null,
                registeredAt: new Date().toISOString(),
                subscription: {
                    status: subscriptionStatus,
                    plan: null,
                    startDate: null,
                    endDate: null
                }
            };
            
            if (doc.exists) {
                const firestoreData = doc.data();
                userData.subscription = {
                    status: subscriptionStatus,
                    plan: firestoreData.subscription?.plan || null,
                    startDate: firestoreData.subscription?.startDate || null,
                    endDate: firestoreData.subscription?.endDate || null,
                    active: firestoreData.subscription?.active || false,
                    paymentMethod: firestoreData.subscription?.paymentMethod || null
                };
                userData.name = firestoreData.name || userData.name;
                userData.country = firestoreData.country || null;
                userData.registeredAt = firestoreData.createdAt ? firestoreData.createdAt.toDate().toISOString() : userData.registeredAt;
            }
            
            localStorage.setItem('french_app_current_user', JSON.stringify(userData));
            if (typeof toggleAuthButtons === 'function') {
                toggleAuthButtons(true, user.displayName || user.email, userData.subscription.status);
            }
            
            // Update subscription pricing based on user's country from Firebase
            if (typeof updateSubscriptionPricingForUser === 'function') {
                updateSubscriptionPricingForUser();
            }
        } catch (error) {
            console.error('Error getting user subscription:', error);
            // Still create basic localStorage entry
            const userData = {
                email: user.email,
                name: user.displayName || user.email,
                country: null,
                registeredAt: new Date().toISOString(),
                subscription: { status: 'free', plan: null, startDate: null, endDate: null }
            };
            localStorage.setItem('french_app_current_user', JSON.stringify(userData));
            if (typeof toggleAuthButtons === 'function') {
                toggleAuthButtons(true, user.displayName || user.email, 'free');
            }
        }
    } else {
        // User is signed out - clear localStorage
        localStorage.removeItem('french_app_current_user');
        if (typeof toggleAuthButtons === 'function') {
            toggleAuthButtons(false);
        }
    }
});

// Replace the localStorage-based functions when Firebase is enabled
function enableFirebaseAuth() {
    // Update event listeners to use Firebase functions
    if (document.getElementById('signUpForm')) {
        document.getElementById('signUpForm').removeEventListener('submit', handleSignUp);
        document.getElementById('signUpForm').addEventListener('submit', handleFirebaseSignUp);
    }
    if (document.getElementById('signInForm')) {
        document.getElementById('signInForm').removeEventListener('submit', handleSignIn);
        document.getElementById('signInForm').addEventListener('submit', handleFirebaseSignIn);
    }
    
    // Update sign out function
    window.signOut = handleFirebaseSignOut;
    
    // Add subscription management functions to global scope
    window.getUserSubscriptionStatus = getUserSubscriptionStatus;
}

// Automatically enable Firebase auth if Firebase is loaded
if (typeof firebase !== 'undefined') {
    enableFirebaseAuth();
}
    </script>

    <!-- Donation Modal -->
    <div id="donationModal" class="modal">
        <div class="modal-content subscription-modal-content">
            <span class="close" onclick="closeModal('donationModal')">&times;</span>
            <h2>‚ù§Ô∏è Support Global Education</h2>
            <p style="text-align: center; color: #666; margin-bottom: 2rem;">
                Help support the GK Foundation's mission to provide free education globally. Your donation directly funds the development of new educational content, maintains our learning platform, and expands access to quality education for students and professionals worldwide.
            </p>
            <div id="donationError" class="error-message"></div>
            <div id="donationSuccess" class="success-message"></div>
            
            <!-- Suggested Donation Amounts -->
            <div class="donation-amounts">
                <h3 style="text-align: center; margin-bottom: 1rem;">Choose an amount</h3>
                <div class="amount-buttons">
                    <button class="amount-btn" onclick="selectDonationAmount(5)">$5</button>
                    <button class="amount-btn" onclick="selectDonationAmount(10)">$10</button>
                    <button class="amount-btn" onclick="selectDonationAmount(25)">$25</button>
                    <button class="amount-btn" onclick="selectDonationAmount(50)">$50</button>
                </div>
                
                <!-- Custom Amount Input -->
                <div class="custom-amount">
                    <label for="customAmount">Or enter a custom amount:</label>
                    <div class="amount-input-container">
                        <span class="currency-symbol">$</span>
                        <input type="number" 
                               id="customAmount" 
                               placeholder="0.00" 
                               min="1" 
                               step="0.01"
                               onchange="selectCustomAmount(this.value)"
                               onfocus="clearAmountSelection()">
                    </div>
                </div>
            </div>

            <!-- Payment Section -->
            <div id="donationPaymentSection" class="payment-section" style="display: none; margin-top: 2rem;">
                <h3>Payment Details</h3>
                
                <div class="selected-amount-display">
                    <p>Donation Amount: <strong id="selectedDonationAmount">$0.00</strong></p>
                </div>

                <div class="form-group">
                    <label for="donationCardholderName">Cardholder Name</label>
                    <input type="text" id="donationCardholderName" placeholder="Your full name" required>
                </div>

                <div class="form-group">
                    <label for="donation-card-element">Credit or Debit Card</label>
                    <div id="donation-card-element">
                        <!-- Stripe Elements will create form elements here -->
                    </div>
                    <div id="donation-card-errors" role="alert" style="color: #721c24; margin-top: 0.5rem;"></div>
                </div>

                <button type="button" class="subscription-btn-modal" id="donateProcessBtn" onclick="processDonation()">
                    <span id="donateBtnText">Complete Donation</span>
                    <span id="donateSpinner" class="spinner"></span>
                </button>
            </div>

            <div style="text-align: center; margin-top: 1rem; color: #666; font-size: 0.85rem;">
                <p style="margin: 0.25rem 0;">üîí Secure donation processing by Stripe</p>
                <p style="margin: 0.25rem 0;">üíù Every contribution supports the Foundation's educational mission</p>
            </div>
        </div>
    </div>

    <script>
        // Donation system variables
        let selectedDonationAmount = 0;
        let donationCardElement = null;

        // Function to update donation amounts based on user currency
        async function updateDonationAmounts() {
            try {
                const userCurrency = await getUserCurrency();
                const amountButtons = document.querySelectorAll('.amount-btn');
                const currencySymbol = document.querySelector('.currency-symbol');
                
                let amounts, symbol;
                
                if (userCurrency === 'INR') {
                    amounts = [10, 20, 30, 40]; // INR amounts (‚Çπ10 to ‚Çπ40)
                    symbol = '‚Çπ';
                } else if (userCurrency === 'CAD') {
                    amounts = [3, 4, 5, 6]; // CAD amounts ($3 to $6 CAD)
                    symbol = '$';
                } else {
                    amounts = [2, 3, 4, 5]; // USD amounts ($2 to $5 USD - default)
                    symbol = '$';
                }
                
                // Update amount buttons
                amountButtons.forEach((btn, index) => {
                    if (index < amounts.length) {
                        const amount = amounts[index];
                        btn.textContent = `${symbol}${amount}`;
                        btn.onclick = () => selectDonationAmount(amount);
                    }
                });
                
                // Update currency symbol in custom input
                if (currencySymbol) {
                    currencySymbol.textContent = symbol;
                }
                
                console.log('üí∞ Updated donation amounts for currency:', userCurrency, amounts);
            } catch (error) {
                console.error('‚ùå Error updating donation amounts:', error);
                // Fallback to USD
                const amountButtons = document.querySelectorAll('.amount-btn');
                amountButtons.forEach((btn, index) => {
                    const amounts = [2, 3, 4, 5]; // USD fallback amounts
                    if (index < amounts.length) {
                        btn.textContent = `$${amounts[index]}`;
                        btn.onclick = () => selectDonationAmount(amounts[index]);
                    }
                });
            }
        }

        // Open Donation Modal
        function openDonationModal() {
            console.log('üéÅ Opening donation modal...');
            
            // Reset any previous selections
            selectedDonationAmount = 0;
            clearAmountSelection();
            document.getElementById('donationPaymentSection').style.display = 'none';
            document.getElementById('donationError').textContent = '';
            document.getElementById('donationSuccess').textContent = '';
            
            // Update donation amounts based on user currency
            updateDonationAmounts();
            
            // Initialize Stripe for donations if not already done
            if (!donationCardElement) {
                initializeDonationStripe();
            }
            
            document.getElementById('donationModal').style.display = 'block';
        }

        // Initialize Stripe Elements for Donation
        function initializeDonationStripe() {
            console.log('üîÑ Initializing Stripe for donations...');
            
            if (typeof Stripe === 'undefined') {
                console.error('‚ùå Stripe.js not loaded');
                showError('donationError', 'Payment system not available. Please refresh the page.');
                return;
            }

            try {
                // Use existing stripe instance from Tech-Pay system
                if (!stripe) {
                    const publishableKey = getStripePublishableKey();
                    stripe = Stripe(publishableKey);
                    elements = stripe.elements();
                }
                
                // Create separate card element for donations
                donationCardElement = elements.create('card', {
                    style: {
                        base: {
                            fontSize: '16px',
                            color: '#424770',
                            '::placeholder': {
                                color: '#aab7c4',
                            },
                        },
                    },
                    hidePostalCode: true
                });
                
                donationCardElement.mount('#donation-card-element');
                
                // Handle real-time validation errors
                donationCardElement.on('change', ({error}) => {
                    const displayError = document.getElementById('donation-card-errors');
                    if (error) {
                        displayError.textContent = error.message;
                    } else {
                        displayError.textContent = '';
                    }
                });
                
                console.log('‚úÖ Donation Stripe initialized successfully');
                
            } catch (error) {
                console.error('‚ùå Error initializing donation Stripe:', error);
                showError('donationError', 'Payment system initialization failed. Please refresh the page.');
            }
        }

        // Select Donation Amount (Preset)
        function selectDonationAmount(amount) {
            console.log('üíù Donation amount selected:', amount);
            
            selectedDonationAmount = amount;
            
            // Clear custom amount input
            document.getElementById('customAmount').value = '';
            
            // Update button states
            updateAmountButtons(amount);
            
            // Show payment section
            showDonationPaymentSection();
        }

        // Select Custom Donation Amount
        function selectCustomAmount(amount) {
            const numAmount = parseFloat(amount);
            if (numAmount && numAmount >= 1) {
                console.log('üíù Custom donation amount:', numAmount);
                selectedDonationAmount = numAmount;
                
                // Clear preset button selections
                clearAmountSelection();
                
                // Show payment section
                showDonationPaymentSection();
            } else {
                selectedDonationAmount = 0;
                document.getElementById('donationPaymentSection').style.display = 'none';
            }
        }

        // Clear Amount Selection
        function clearAmountSelection() {
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        // Update Amount Button States
        function updateAmountButtons(selectedAmount) {
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === `$${selectedAmount}`) {
                    btn.classList.add('selected');
                }
            });
        }

        // Show Donation Payment Section
        function showDonationPaymentSection() {
            document.getElementById('selectedDonationAmount').textContent = `$${selectedDonationAmount.toFixed(2)}`;
            document.getElementById('donationPaymentSection').style.display = 'block';
            
            // Scroll to payment section
            document.getElementById('donationPaymentSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest' 
            });
        }

        // Process Donation (Tech-Pay Integration)
        async function processDonation() {
            if (!selectedDonationAmount || selectedDonationAmount < 1) {
                showError('donationError', 'Please select a donation amount of at least $1.');
                return;
            }
            
            const cardholderName = document.getElementById('donationCardholderName').value;
            if (!cardholderName.trim()) {
                showError('donationError', 'Please enter the cardholder name.');
                return;
            }
            
            // Show loading
            const donateBtn = document.getElementById('donateProcessBtn');
            const donateBtnText = document.getElementById('donateBtnText');
            const donateSpinner = document.getElementById('donateSpinner');
            
            donateBtnText.style.display = 'none';
            donateSpinner.style.display = 'inline';
            donateBtn.disabled = true;
            
            try {
                // Create payment method with Stripe
                const {error, paymentMethod} = await stripe.createPaymentMethod({
                    type: 'card',
                    card: donationCardElement,
                    billing_details: {
                        name: cardholderName,
                    },
                });
                
                if (error) {
                    throw new Error(error.message);
                }
                
                console.log('‚úÖ Donation payment method created:', paymentMethod.id);
                
                // Get user currency (reuse existing function)
                const userCurrency = await getUserCurrency();
                // üí∞ CLEAR PRICING: Customer pays exactly what's displayed
                let amountInCents = Math.round(selectedDonationAmount * 100);
                
                // Standard currency conversion (displayed prices already include fees)
                if (userCurrency === 'CAD') {
                    amountInCents = Math.round(selectedDonationAmount * 100); // CAD cents
                } else if (userCurrency === 'INR') {
                    amountInCents = Math.round(selectedDonationAmount * 100); // INR paisa (1 INR = 100 paisa)
                } else {
                    amountInCents = Math.round(selectedDonationAmount * 100); // USD cents
                }
                
                console.log('üí≥ Processing donation:', amountInCents, userCurrency);
                
                // LIVE ENVIRONMENT: Backend Donation Processing with Stripe Payment Intents
                if (STRIPE_CONFIG.environment === 'live') {
                    try {
                        console.log('üíù Creating donation payment intent with backend...');
                        
                        // Get current user for customer details
                        const currentUser = JSON.parse(localStorage.getItem('french_app_current_user') || '{}');
                        
                        // Create donation payment intent via backend
                        const response = await fetch('https://foundation-backend-chi.vercel.app/create-payment-intent', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                planType: 'donation',
                                currency: userCurrency,
                                amount: amountInCents,
                                customerEmail: currentUser.email || '',
                                customerName: currentUser.displayName || cardholderName
                            })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Donation setup failed');
                        }
                        
                        const { clientSecret, paymentIntentId } = await response.json();
                        console.log('‚úÖ Donation payment intent created:', paymentIntentId);
                        
                        // Confirm donation payment with Stripe
                        const { error: confirmError, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
                            payment_method: paymentMethod.id
                        });
                        
                        if (confirmError) {
                            throw new Error(confirmError.message);
                        }
                        
                        if (paymentIntent.status !== 'succeeded') {
                            throw new Error('Donation was not completed successfully');
                        }
                        
                        console.log('‚úÖ LIVE donation processed successfully!');
                        console.log('üí∞ Donation Details:', paymentIntent);
                        
                    } catch (donationError) {
                        console.error('‚ùå Live donation processing error:', donationError);
                        throw donationError;
                    }
                } else {
                    // Test environment processing
                    console.log('‚úÖ Donation processed successfully with Stripe using test card');
                }
                
                // Log donation in Firebase (optional)
                await logDonation(selectedDonationAmount, userCurrency, paymentMethod.id, cardholderName);
                
                console.log('‚úÖ Donation completed successfully');
                
                showSuccess('donationSuccess', `üéâ Thank you for your $${selectedDonationAmount.toFixed(2)} donation! Your support helps the GK Foundation expand free educational access globally.`);
                
                // Store amount before modal reset
                const finalDonationAmount = selectedDonationAmount;
                
                setTimeout(() => {
                    closeModal('donationModal');
                    
                    // Show appreciation message with preserved amount
                    alert(`üíù Thank you for supporting the GK Foundation! Your $${finalDonationAmount.toFixed(2)} donation helps us fulfill our mission of providing free, quality education to students and professionals worldwide.`);
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Donation processing error:', error);
                showError('donationError', error.message);
                
            } finally {
                // Reset button state
                donateBtnText.style.display = 'inline';
                donateSpinner.style.display = 'none';
                donateBtn.disabled = false;
            }
        }

        // Log Donation (Optional - for record keeping)
        async function logDonation(amount, currency, paymentMethodId, donorName) {
            try {
                const currentUser = JSON.parse(localStorage.getItem('french_app_current_user'));
                const firebaseUser = firebase.auth().currentUser;
                
                const donationData = {
                    amount: amount,
                    currency: currency,
                    donorName: donorName,
                    paymentMethodId: paymentMethodId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: firebaseUser ? firebaseUser.uid : null,
                    userEmail: firebaseUser ? firebaseUser.email : 'anonymous',
                    environment: STRIPE_CONFIG.environment
                };
                
                // Log to Firebase (if available)
                if (typeof firebase !== 'undefined' && firebase.firestore) {
                    await firebase.firestore().collection('donations').add(donationData);
                    console.log('üìù Donation logged to Firebase');
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not log donation:', error);
                // Don't throw error - donation was successful even if logging failed
            }
        }
    </script>
</body>
</html> 